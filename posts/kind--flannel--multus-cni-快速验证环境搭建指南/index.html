<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>Kind + Flannel + Multus-CNI 快速验证环境搭建指南 - 蜷缩的蜗牛</title><meta name=author content="云原生运维专家">
<meta name=description content="使用 Kind 快速创建 Kubernetes 环境，验证 Flannel + Multus-CNI 多网段隔离方案的完整实施指南"><meta name=keywords content='Kind,Kubernetes,Flannel,Multus,CNI,验证环境'><meta itemprop=name content="Kind + Flannel + Multus-CNI 快速验证环境搭建指南"><meta itemprop=description content="使用 Kind 快速创建 Kubernetes 环境，验证 Flannel + Multus-CNI 多网段隔离方案的完整实施指南"><meta itemprop=datePublished content="2024-12-19T10:45:00+08:00"><meta itemprop=dateModified content="2024-12-19T10:45:00+08:00"><meta itemprop=wordCount content="7064"><meta itemprop=image content="https://www.kbsonlong.com/logo_transparent.png"><meta itemprop=keywords content="Kind,Kubernetes,Flannel,Multus,CNI,验证环境"><meta property="og:url" content="https://www.kbsonlong.com/posts/kind--flannel--multus-cni-%E5%BF%AB%E9%80%9F%E9%AA%8C%E8%AF%81%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97/"><meta property="og:site_name" content="蜷缩的蜗牛"><meta property="og:title" content="Kind + Flannel + Multus-CNI 快速验证环境搭建指南"><meta property="og:description" content="使用 Kind 快速创建 Kubernetes 环境，验证 Flannel + Multus-CNI 多网段隔离方案的完整实施指南"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-12-19T10:45:00+08:00"><meta property="article:modified_time" content="2024-12-19T10:45:00+08:00"><meta property="article:tag" content="Kind"><meta property="article:tag" content="Kubernetes"><meta property="article:tag" content="Flannel"><meta property="article:tag" content="Multus"><meta property="article:tag" content="CNI"><meta property="article:tag" content="验证环境"><meta property="og:image" content="https://www.kbsonlong.com/logo_transparent.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.kbsonlong.com/logo_transparent.png"><meta name=twitter:title content="Kind + Flannel + Multus-CNI 快速验证环境搭建指南"><meta name=twitter:description content="使用 Kind 快速创建 Kubernetes 环境，验证 Flannel + Multus-CNI 多网段隔离方案的完整实施指南"><meta name=application-name content="FixIt"><meta name=apple-mobile-web-app-title content="FixIt"><meta name=theme-color data-light=#ffffff data-dark=#252627 content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical type=text/html href=https://www.kbsonlong.com/posts/kind--flannel--multus-cni-%E5%BF%AB%E9%80%9F%E9%AA%8C%E8%AF%81%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97/ title="Kind + Flannel + Multus-CNI 快速验证环境搭建指南 - 蜷缩的蜗牛"><link rel=prev type=text/html href=https://www.kbsonlong.com/posts/flannel--multus-cni-%E5%A4%9A%E7%BD%91%E6%AE%B5%E9%9A%94%E7%A6%BB%E5%AE%9E%E7%8E%B0%E6%8C%87%E5%8D%97/ title="Flannel + Multus-CNI 多网段隔离实现指南"><link rel=next type=text/html href=https://www.kbsonlong.com/posts/grafana-api%E5%AF%BC%E5%87%BA%E4%BB%AA%E8%A1%A8%E6%9D%BF%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/ title="Grafana API导出仪表板完整指南"><link rel=alternate type=text/markdown href=https://www.kbsonlong.com/posts/kind--flannel--multus-cni-%E5%BF%AB%E9%80%9F%E9%AA%8C%E8%AF%81%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97/index.md title="Kind + Flannel + Multus-CNI 快速验证环境搭建指南 - 蜷缩的蜗牛"><link rel=stylesheet href=/css/style.min.css><link rel=preload href=/lib/fontawesome-free/all.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/lib/animate/animate.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Kind + Flannel + Multus-CNI 快速验证环境搭建指南","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.kbsonlong.com\/posts\/kind--flannel--multus-cni-%E5%BF%AB%E9%80%9F%E9%AA%8C%E8%AF%81%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97\/"},"genre":"posts","keywords":"Kind, Kubernetes, Flannel, Multus, CNI, 验证环境","wordcount":7064,"url":"https:\/\/www.kbsonlong.com\/posts\/kind--flannel--multus-cni-%E5%BF%AB%E9%80%9F%E9%AA%8C%E8%AF%81%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97\/","datePublished":"2024-12-19T10:45:00+08:00","dateModified":"2024-12-19T10:45:00+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"云原生运维专家"},"description":"使用 Kind 快速创建 Kubernetes 环境，验证 Flannel + Multus-CNI 多网段隔离方案的完整实施指南"}</script><script src=/js/head/color-scheme.min.js></script></head><body data-header-desktop=sticky data-header-mobile=auto><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=right><div class=header-title><a href=/ title=蜷缩的蜗牛><img class=logo src=/logo_transparent.png alt=蜷缩的蜗牛 height=32 width=32><span class=header-title-text>蜷缩的蜗牛</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/posts/><i class='fa-solid fa-archive fa-fw fa-sm'></i> 文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class='fa-solid fa-th fa-fw fa-sm'></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class='fa-solid fa-tags fa-fw fa-sm'></i> 标签</a></li><li class=menu-item><a class=menu-link href=/friends/ title=友情链接><i class='fa-solid fa-users fa-fw fa-sm'></i> 友链</a></li><li class=menu-item><a class=menu-link href=/about/><i class='fa-solid fa-info-circle fa-fw fa-sm'></i> 关于</a></li><li class="menu-item d-none-desktop text-center"><a class=menu-link href=https://github.com/kbsonlong/ title=GitHub rel="noopener noreferrer" target=_blank><i class='fa-brands fa-github fa-fw'></i></a></li><li class="menu-item d-none-desktop text-center"><a class=menu-link href=/messages/><i class='fa-solid fa-messages'></i> 留言板</a></li><li class=menu-item><a class=menu-link href=/messages/ title=留言板>留言板</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容…… id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li><li class="menu-item language-switch"><span role=button aria-label=选择语言 title=选择语言><i class="fa-solid fa-language fa-fw" aria-hidden=true></i></span><ul class=sub-menu><li class=menu-item>没有更多翻译</li></ul></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=蜷缩的蜗牛><img class=logo src=/logo_transparent.png alt=蜷缩的蜗牛 height=26 width=26><span class=header-title-text>蜷缩的蜗牛</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容…… id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/posts/><i class='fa-solid fa-archive fa-fw fa-sm'></i> 文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class='fa-solid fa-th fa-fw fa-sm'></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class='fa-solid fa-tags fa-fw fa-sm'></i> 标签</a></li><li class=menu-item><a class=menu-link href=/friends/ title=友情链接><i class='fa-solid fa-users fa-fw fa-sm'></i> 友链</a></li><li class=menu-item><a class=menu-link href=/about/><i class='fa-solid fa-info-circle fa-fw fa-sm'></i> 关于</a></li><li class="menu-item d-none-desktop text-center"><a class=menu-link href=https://github.com/kbsonlong/ title=GitHub rel="noopener noreferrer" target=_blank><i class='fa-brands fa-github fa-fw'></i></a></li><li class="menu-item d-none-desktop text-center"><a class=menu-link href=/messages/><i class='fa-solid fa-messages'></i> 留言板</a></li><li class=menu-item><a class=menu-link href=/messages/ title=留言板>留言板</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span><span class="menu-system-item language-switch">
<span role=button aria-label=选择语言 title=选择语言>简体中文<i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden=true></i></span>
<select class=language-select onchange="location=this.value"><option disabled>没有更多翻译</option></select></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label=合集></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>Kind + Flannel + Multus-CNI 快速验证环境搭建指南</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><i class="fa-solid fa-user-circle" aria-hidden=true></i>
云原生运维专家</span></span><span class=post-included-in>&nbsp;收录于 <a href=/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/ class=post-category title="分类 - 云原生"><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> 云原生</a>&ensp;<a href=/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/ class=post-category title="分类 - 开发环境"><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> 开发环境</a></span></div><div class=post-meta-line><span title="发布于 2024-12-19 10:45:00"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden=true></i><time datetime=2024-12-19>2024-12-19</time></span>&nbsp;<span title="7064 字"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>约 7100 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 15 分钟</span>&nbsp;<span id=busuanzi_container_page_pv class="busuanzi_visitors comment-visitors" data-flag-title="Kind + Flannel + Multus-CNI 快速验证环境搭建指南"><i class="fa-regular fa-eye fa-fw me-1" aria-hidden=true></i><span id=busuanzi_value_page_pv>-</span>&nbsp;次阅读
</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#概述>概述</a><ul><li><a href=#环境特点>环境特点</a></li></ul></li><li><a href=#环境要求>环境要求</a><ul><li><a href=#系统要求>系统要求</a></li><li><a href=#必需软件>必需软件</a></li></ul></li><li><a href=#kind-集群配置>Kind 集群配置</a><ul><li><a href=#1-创建-kind-配置文件>1. 创建 Kind 配置文件</a></li><li><a href=#2-创建集群>2. 创建集群</a></li><li><a href=#3-集群基础配置>3. 集群基础配置</a></li></ul></li><li><a href=#flannel-部署>Flannel 部署</a><ul><li><a href=#1-下载-flannel-配置>1. 下载 Flannel 配置</a></li><li><a href=#2-修改-flannel-配置>2. 修改 Flannel 配置</a></li><li><a href=#3-部署-flannel>3. 部署 Flannel</a></li><li><a href=#4-验证基础网络>4. 验证基础网络</a></li></ul></li><li><a href=#multus-cni-部署>Multus-CNI 部署</a><ul><li><a href=#1-创建-multus-配置>1. 创建 Multus 配置</a></li><li><a href=#2-部署-multus-daemonset>2. 部署 Multus DaemonSet</a></li><li><a href=#3-验证-multus-部署>3. 验证 Multus 部署</a></li></ul></li><li><a href=#网络附件定义创建>网络附件定义创建</a><ul><li><a href=#1-创建测试命名空间>1. 创建测试命名空间</a></li><li><a href=#2-创建-macvlan-网络模拟>2. 创建 MacVLAN 网络（模拟）</a></li><li><a href=#3-创建-bridge-网络>3. 创建 Bridge 网络</a></li><li><a href=#4-创建-host-local-网络>4. 创建 Host-Local 网络</a></li><li><a href=#5-应用网络附件定义>5. 应用网络附件定义</a></li></ul></li><li><a href=#验证应用部署>验证应用部署</a><ul><li><a href=#1-单网络测试应用>1. 单网络测试应用</a></li><li><a href=#2-多网络测试应用>2. 多网络测试应用</a></li><li><a href=#3-存储网络测试应用>3. 存储网络测试应用</a></li><li><a href=#4-部署测试应用>4. 部署测试应用</a></li></ul></li><li><a href=#网络验证测试>网络验证测试</a><ul><li><a href=#1-基础网络连通性测试>1. 基础网络连通性测试</a></li><li><a href=#2-多网络接口验证>2. 多网络接口验证</a></li><li><a href=#3-网络性能测试>3. 网络性能测试</a></li></ul></li><li><a href=#故障排查和调试>故障排查和调试</a><ul><li><a href=#1-集群状态检查>1. 集群状态检查</a></li><li><a href=#2-网络问题排查>2. 网络问题排查</a></li><li><a href=#3-日志收集>3. 日志收集</a></li></ul></li><li><a href=#清理和重置>清理和重置</a><ul><li><a href=#1-清理测试资源>1. 清理测试资源</a></li><li><a href=#2-重置集群>2. 重置集群</a></li><li><a href=#3-完全清理>3. 完全清理</a></li></ul></li><li><a href=#自动化脚本>自动化脚本</a><ul><li><a href=#1-一键部署脚本>1. 一键部署脚本</a></li><li><a href=#2-快速验证脚本>2. 快速验证脚本</a></li></ul></li><li><a href=#总结>总结</a><ul><li><a href=#-实现目标>🎯 实现目标</a></li><li><a href=#-技术特性>🔧 技术特性</a></li><li><a href=#-使用流程>📋 使用流程</a></li><li><a href=#-扩展应用>🚀 扩展应用</a></li></ul></li></ul></nav></div></div><div class=content id=content><h2 class=heading-element id=概述><span>概述</span>
<a href=#%e6%a6%82%e8%bf%b0 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>本指南将帮助您使用 <strong>Kind (Kubernetes in Docker)</strong> 快速创建一个 Kubernetes 环境，并在其中部署和验证 <strong>Flannel + Multus-CNI</strong> 多网段隔离方案。这是一个完整的端到端验证环境，适合开发、测试和学习使用。</p><h3 class=heading-element id=环境特点><span>环境特点</span>
<a href=#%e7%8e%af%e5%a2%83%e7%89%b9%e7%82%b9 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><ul><li><strong>快速部署</strong>：5分钟内完成集群创建</li><li><strong>完整功能</strong>：支持多网段隔离验证</li><li><strong>易于清理</strong>：一键删除整个环境</li><li><strong>资源友好</strong>：适合本地开发机器运行</li></ul><h2 class=heading-element id=环境要求><span>环境要求</span>
<a href=#%e7%8e%af%e5%a2%83%e8%a6%81%e6%b1%82 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=系统要求><span>系统要求</span>
<a href=#%e7%b3%bb%e7%bb%9f%e8%a6%81%e6%b1%82 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 检查系统信息</span>
</span></span><span class=line><span class=cl>uname -a
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 检查可用内存（建议 8GB+）</span>
</span></span><span class=line><span class=cl>free -h
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 检查磁盘空间（建议 20GB+）</span>
</span></span><span class=line><span class=cl>df -h</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=必需软件><span>必需软件</span>
<a href=#%e5%bf%85%e9%9c%80%e8%bd%af%e4%bb%b6 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1. Docker 安装和配置</span>
</span></span><span class=line><span class=cl><span class=c1># macOS</span>
</span></span><span class=line><span class=cl>brew install docker
</span></span><span class=line><span class=cl><span class=c1># 或者下载 Docker Desktop</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Linux (Ubuntu/Debian)</span>
</span></span><span class=line><span class=cl>sudo apt-get update
</span></span><span class=line><span class=cl>sudo apt-get install docker.io
</span></span><span class=line><span class=cl>sudo systemctl <span class=nb>enable</span> docker
</span></span><span class=line><span class=cl>sudo systemctl start docker
</span></span><span class=line><span class=cl>sudo usermod -aG docker <span class=nv>$USER</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 验证 Docker</span>
</span></span><span class=line><span class=cl>docker version
</span></span><span class=line><span class=cl>docker run hello-world</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 2. Kind 安装</span>
</span></span><span class=line><span class=cl><span class=c1># macOS</span>
</span></span><span class=line><span class=cl>brew install kind
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Linux</span>
</span></span><span class=line><span class=cl>curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.20.0/kind-linux-amd64
</span></span><span class=line><span class=cl>chmod +x ./kind
</span></span><span class=line><span class=cl>sudo mv ./kind /usr/local/bin/kind
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 验证 Kind</span>
</span></span><span class=line><span class=cl>kind version</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 3. kubectl 安装</span>
</span></span><span class=line><span class=cl><span class=c1># macOS</span>
</span></span><span class=line><span class=cl>brew install kubectl
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Linux</span>
</span></span><span class=line><span class=cl>curl -LO <span class=s2>&#34;https://dl.k8s.io/release/</span><span class=k>$(</span>curl -L -s https://dl.k8s.io/release/stable.txt<span class=k>)</span><span class=s2>/bin/linux/amd64/kubectl&#34;</span>
</span></span><span class=line><span class=cl>chmod +x kubectl
</span></span><span class=line><span class=cl>sudo mv kubectl /usr/local/bin/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 验证 kubectl</span>
</span></span><span class=line><span class=cl>kubectl version --client</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 4. Helm 安装（可选）</span>
</span></span><span class=line><span class=cl><span class=c1># macOS</span>
</span></span><span class=line><span class=cl>brew install helm
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Linux</span>
</span></span><span class=line><span class=cl>curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 <span class=p>|</span> bash
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 验证 Helm</span>
</span></span><span class=line><span class=cl>helm version</span></span></code></pre></td></tr></table></div></div><h2 class=heading-element id=kind-集群配置><span>Kind 集群配置</span>
<a href=#kind-%e9%9b%86%e7%be%a4%e9%85%8d%e7%bd%ae class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=1-创建-kind-配置文件><span>1. 创建 Kind 配置文件</span>
<a href=#1-%e5%88%9b%e5%bb%ba-kind-%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># kind-config.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Cluster</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>kind.x-k8s.io/v1alpha4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>flannel-multus-demo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>networking</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 禁用默认 CNI，我们将手动安装 Flannel</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>disableDefaultCNI</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 配置 Pod 子网</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>podSubnet</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;10.244.0.0/16&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 配置 Service 子网</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>serviceSubnet</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;10.96.0.0/12&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># API Server 端口</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>apiServerPort</span><span class=p>:</span><span class=w> </span><span class=m>6443</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>nodes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 控制平面节点</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>role</span><span class=p>:</span><span class=w> </span><span class=l>control-plane</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>kindest/node:v1.28.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>kubeadmConfigPatches</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>    kind: InitConfiguration
</span></span></span><span class=line><span class=cl><span class=sd>    nodeRegistration:
</span></span></span><span class=line><span class=cl><span class=sd>      kubeletExtraArgs:
</span></span></span><span class=line><span class=cl><span class=sd>        node-labels: &#34;ingress-ready=true&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extraPortMappings</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># HTTP 端口映射</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>hostPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># HTTPS 端口映射</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>443</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>hostPort</span><span class=p>:</span><span class=w> </span><span class=m>443</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 额外的网络接口配置</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extraMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>hostPath</span><span class=p>:</span><span class=w> </span><span class=l>/dev</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>containerPath</span><span class=p>:</span><span class=w> </span><span class=l>/dev</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>propagation</span><span class=p>:</span><span class=w> </span><span class=l>HostToContainer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 工作节点 1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>role</span><span class=p>:</span><span class=w> </span><span class=l>worker</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>kindest/node:v1.28.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>node-type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;business&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extraMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>hostPath</span><span class=p>:</span><span class=w> </span><span class=l>/dev</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>containerPath</span><span class=p>:</span><span class=w> </span><span class=l>/dev</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>propagation</span><span class=p>:</span><span class=w> </span><span class=l>HostToContainer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 工作节点 2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>role</span><span class=p>:</span><span class=w> </span><span class=l>worker</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>kindest/node:v1.28.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>node-type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;storage&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extraMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>hostPath</span><span class=p>:</span><span class=w> </span><span class=l>/dev</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>containerPath</span><span class=p>:</span><span class=w> </span><span class=l>/dev</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>propagation</span><span class=p>:</span><span class=w> </span><span class=l>HostToContainer</span></span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=2-创建集群><span>2. 创建集群</span>
<a href=#2-%e5%88%9b%e5%bb%ba%e9%9b%86%e7%be%a4 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 创建 Kind 集群</span>
</span></span><span class=line><span class=cl>kind create cluster --config<span class=o>=</span>kind-config.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 验证集群状态</span>
</span></span><span class=line><span class=cl>kubectl cluster-info
</span></span><span class=line><span class=cl>kubectl get nodes -o wide
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 检查节点标签</span>
</span></span><span class=line><span class=cl>kubectl get nodes --show-labels</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=3-集群基础配置><span>3. 集群基础配置</span>
<a href=#3-%e9%9b%86%e7%be%a4%e5%9f%ba%e7%a1%80%e9%85%8d%e7%bd%ae class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 等待节点就绪</span>
</span></span><span class=line><span class=cl>kubectl <span class=nb>wait</span> --for<span class=o>=</span><span class=nv>condition</span><span class=o>=</span>Ready nodes --all --timeout<span class=o>=</span>300s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 检查系统 Pod 状态</span>
</span></span><span class=line><span class=cl>kubectl get pods -n kube-system
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 由于禁用了默认 CNI，节点会显示 NotReady，这是正常的</span>
</span></span><span class=line><span class=cl>kubectl get nodes</span></span></code></pre></td></tr></table></div></div><h2 class=heading-element id=flannel-部署><span>Flannel 部署</span>
<a href=#flannel-%e9%83%a8%e7%bd%b2 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=1-下载-flannel-配置><span>1. 下载 Flannel 配置</span>
<a href=#1-%e4%b8%8b%e8%bd%bd-flannel-%e9%85%8d%e7%bd%ae class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 下载官方 Flannel 配置</span>
</span></span><span class=line><span class=cl>wget https://github.com/flannel-io/flannel/releases/latest/download/kube-flannel.yml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 或者使用 curl</span>
</span></span><span class=line><span class=cl>curl -O https://github.com/flannel-io/flannel/releases/latest/download/kube-flannel.yml</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=2-修改-flannel-配置><span>2. 修改 Flannel 配置</span>
<a href=#2-%e4%bf%ae%e6%94%b9-flannel-%e9%85%8d%e7%bd%ae class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 备份原始配置</span>
</span></span><span class=line><span class=cl>cp kube-flannel.yml kube-flannel.yml.backup
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 修改配置以适配 Kind 环境</span>
</span></span><span class=line><span class=cl>cat &gt; flannel-kind-patch.yaml <span class=s>&lt;&lt; &#39;EOF&#39;
</span></span></span><span class=line><span class=cl><span class=s>apiVersion: v1
</span></span></span><span class=line><span class=cl><span class=s>kind: ConfigMap
</span></span></span><span class=line><span class=cl><span class=s>metadata:
</span></span></span><span class=line><span class=cl><span class=s>  name: kube-flannel-cfg
</span></span></span><span class=line><span class=cl><span class=s>  namespace: kube-flannel
</span></span></span><span class=line><span class=cl><span class=s>  labels:
</span></span></span><span class=line><span class=cl><span class=s>    tier: node
</span></span></span><span class=line><span class=cl><span class=s>    app: flannel
</span></span></span><span class=line><span class=cl><span class=s>    k8s-app: flannel
</span></span></span><span class=line><span class=cl><span class=s>data:
</span></span></span><span class=line><span class=cl><span class=s>  cni-conf.json: |
</span></span></span><span class=line><span class=cl><span class=s>    {
</span></span></span><span class=line><span class=cl><span class=s>      &#34;name&#34;: &#34;cbr0&#34;,
</span></span></span><span class=line><span class=cl><span class=s>      &#34;cniVersion&#34;: &#34;0.3.1&#34;,
</span></span></span><span class=line><span class=cl><span class=s>      &#34;plugins&#34;: [
</span></span></span><span class=line><span class=cl><span class=s>        {
</span></span></span><span class=line><span class=cl><span class=s>          &#34;type&#34;: &#34;flannel&#34;,
</span></span></span><span class=line><span class=cl><span class=s>          &#34;delegate&#34;: {
</span></span></span><span class=line><span class=cl><span class=s>            &#34;hairpinMode&#34;: true,
</span></span></span><span class=line><span class=cl><span class=s>            &#34;isDefaultGateway&#34;: true
</span></span></span><span class=line><span class=cl><span class=s>          }
</span></span></span><span class=line><span class=cl><span class=s>        },
</span></span></span><span class=line><span class=cl><span class=s>        {
</span></span></span><span class=line><span class=cl><span class=s>          &#34;type&#34;: &#34;portmap&#34;,
</span></span></span><span class=line><span class=cl><span class=s>          &#34;capabilities&#34;: {
</span></span></span><span class=line><span class=cl><span class=s>            &#34;portMappings&#34;: true
</span></span></span><span class=line><span class=cl><span class=s>          }
</span></span></span><span class=line><span class=cl><span class=s>        }
</span></span></span><span class=line><span class=cl><span class=s>      ]
</span></span></span><span class=line><span class=cl><span class=s>    }
</span></span></span><span class=line><span class=cl><span class=s>  net-conf.json: |
</span></span></span><span class=line><span class=cl><span class=s>    {
</span></span></span><span class=line><span class=cl><span class=s>      &#34;Network&#34;: &#34;10.244.0.0/16&#34;,
</span></span></span><span class=line><span class=cl><span class=s>      &#34;Backend&#34;: {
</span></span></span><span class=line><span class=cl><span class=s>        &#34;Type&#34;: &#34;vxlan&#34;
</span></span></span><span class=line><span class=cl><span class=s>      }
</span></span></span><span class=line><span class=cl><span class=s>    }
</span></span></span><span class=line><span class=cl><span class=s>EOF</span></span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=3-部署-flannel><span>3. 部署 Flannel</span>
<a href=#3-%e9%83%a8%e7%bd%b2-flannel class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 创建 Flannel 命名空间</span>
</span></span><span class=line><span class=cl>kubectl create namespace kube-flannel
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 应用修改后的配置</span>
</span></span><span class=line><span class=cl>kubectl apply -f flannel-kind-patch.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 部署 Flannel</span>
</span></span><span class=line><span class=cl>kubectl apply -f kube-flannel.yml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 等待 Flannel Pod 就绪</span>
</span></span><span class=line><span class=cl>kubectl <span class=nb>wait</span> --for<span class=o>=</span><span class=nv>condition</span><span class=o>=</span>Ready pods -l <span class=nv>app</span><span class=o>=</span>flannel -n kube-flannel --timeout<span class=o>=</span>300s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 验证 Flannel 状态</span>
</span></span><span class=line><span class=cl>kubectl get pods -n kube-flannel
</span></span><span class=line><span class=cl>kubectl logs -n kube-flannel -l <span class=nv>app</span><span class=o>=</span>flannel</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=4-验证基础网络><span>4. 验证基础网络</span>
<a href=#4-%e9%aa%8c%e8%af%81%e5%9f%ba%e7%a1%80%e7%bd%91%e7%bb%9c class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 检查节点状态（应该变为 Ready）</span>
</span></span><span class=line><span class=cl>kubectl get nodes
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 检查 CNI 配置</span>
</span></span><span class=line><span class=cl><span class=k>for</span> node in <span class=k>$(</span>kubectl get nodes -o name <span class=p>|</span> cut -d/ -f2<span class=k>)</span><span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;=== Node: </span><span class=nv>$node</span><span class=s2> ===&#34;</span>
</span></span><span class=line><span class=cl>    docker <span class=nb>exec</span> <span class=nv>$node</span> ls -la /etc/cni/net.d/
</span></span><span class=line><span class=cl>    docker <span class=nb>exec</span> <span class=nv>$node</span> cat /etc/cni/net.d/10-flannel.conflist
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 测试基础网络连通性</span>
</span></span><span class=line><span class=cl>kubectl run test-pod --image<span class=o>=</span>busybox --rm -it --restart<span class=o>=</span>Never -- /bin/sh
</span></span><span class=line><span class=cl><span class=c1># 在 Pod 中执行：ping kubernetes.default.svc.cluster.local</span></span></span></code></pre></td></tr></table></div></div><h2 class=heading-element id=multus-cni-部署><span>Multus-CNI 部署</span>
<a href=#multus-cni-%e9%83%a8%e7%bd%b2 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=1-创建-multus-配置><span>1. 创建 Multus 配置</span>
<a href=#1-%e5%88%9b%e5%bb%ba-multus-%e9%85%8d%e7%bd%ae class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 创建 Multus 系统命名空间</span>
</span></span><span class=line><span class=cl>kubectl create namespace multus-system
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建 Multus ConfigMap</span>
</span></span><span class=line><span class=cl>cat &gt; multus-config.yaml <span class=s>&lt;&lt; &#39;EOF&#39;
</span></span></span><span class=line><span class=cl><span class=s>apiVersion: v1
</span></span></span><span class=line><span class=cl><span class=s>kind: ConfigMap
</span></span></span><span class=line><span class=cl><span class=s>metadata:
</span></span></span><span class=line><span class=cl><span class=s>  name: multus-cni-config
</span></span></span><span class=line><span class=cl><span class=s>  namespace: multus-system
</span></span></span><span class=line><span class=cl><span class=s>  labels:
</span></span></span><span class=line><span class=cl><span class=s>    tier: node
</span></span></span><span class=line><span class=cl><span class=s>    app: multus
</span></span></span><span class=line><span class=cl><span class=s>data:
</span></span></span><span class=line><span class=cl><span class=s>  cni-conf.json: |
</span></span></span><span class=line><span class=cl><span class=s>    {
</span></span></span><span class=line><span class=cl><span class=s>      &#34;cniVersion&#34;: &#34;0.3.1&#34;,
</span></span></span><span class=line><span class=cl><span class=s>      &#34;name&#34;: &#34;multus-cni-network&#34;,
</span></span></span><span class=line><span class=cl><span class=s>      &#34;type&#34;: &#34;multus&#34;,
</span></span></span><span class=line><span class=cl><span class=s>      &#34;capabilities&#34;: {
</span></span></span><span class=line><span class=cl><span class=s>        &#34;portMappings&#34;: true
</span></span></span><span class=line><span class=cl><span class=s>      },
</span></span></span><span class=line><span class=cl><span class=s>      &#34;delegates&#34;: [
</span></span></span><span class=line><span class=cl><span class=s>        {
</span></span></span><span class=line><span class=cl><span class=s>          &#34;cniVersion&#34;: &#34;0.3.1&#34;,
</span></span></span><span class=line><span class=cl><span class=s>          &#34;name&#34;: &#34;default-cni-network&#34;,
</span></span></span><span class=line><span class=cl><span class=s>          &#34;plugins&#34;: [
</span></span></span><span class=line><span class=cl><span class=s>            {
</span></span></span><span class=line><span class=cl><span class=s>              &#34;type&#34;: &#34;flannel&#34;,
</span></span></span><span class=line><span class=cl><span class=s>              &#34;delegate&#34;: {
</span></span></span><span class=line><span class=cl><span class=s>                &#34;hairpinMode&#34;: true,
</span></span></span><span class=line><span class=cl><span class=s>                &#34;isDefaultGateway&#34;: true
</span></span></span><span class=line><span class=cl><span class=s>              }
</span></span></span><span class=line><span class=cl><span class=s>            },
</span></span></span><span class=line><span class=cl><span class=s>            {
</span></span></span><span class=line><span class=cl><span class=s>              &#34;type&#34;: &#34;portmap&#34;,
</span></span></span><span class=line><span class=cl><span class=s>              &#34;capabilities&#34;: {
</span></span></span><span class=line><span class=cl><span class=s>                &#34;portMappings&#34;: true
</span></span></span><span class=line><span class=cl><span class=s>              }
</span></span></span><span class=line><span class=cl><span class=s>            }
</span></span></span><span class=line><span class=cl><span class=s>          ]
</span></span></span><span class=line><span class=cl><span class=s>        }
</span></span></span><span class=line><span class=cl><span class=s>      ],
</span></span></span><span class=line><span class=cl><span class=s>      &#34;kubeconfig&#34;: &#34;/etc/cni/net.d/multus.d/multus.kubeconfig&#34;
</span></span></span><span class=line><span class=cl><span class=s>    }
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kubectl apply -f multus-config.yaml</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=2-部署-multus-daemonset><span>2. 部署 Multus DaemonSet</span>
<a href=#2-%e9%83%a8%e7%bd%b2-multus-daemonset class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 创建 Multus RBAC</span>
</span></span><span class=line><span class=cl>cat &gt; multus-rbac.yaml <span class=s>&lt;&lt; &#39;EOF&#39;
</span></span></span><span class=line><span class=cl><span class=s>apiVersion: v1
</span></span></span><span class=line><span class=cl><span class=s>kind: ServiceAccount
</span></span></span><span class=line><span class=cl><span class=s>metadata:
</span></span></span><span class=line><span class=cl><span class=s>  name: multus
</span></span></span><span class=line><span class=cl><span class=s>  namespace: multus-system
</span></span></span><span class=line><span class=cl><span class=s>---
</span></span></span><span class=line><span class=cl><span class=s>apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span class=line><span class=cl><span class=s>kind: ClusterRole
</span></span></span><span class=line><span class=cl><span class=s>metadata:
</span></span></span><span class=line><span class=cl><span class=s>  name: multus
</span></span></span><span class=line><span class=cl><span class=s>rules:
</span></span></span><span class=line><span class=cl><span class=s>- apiGroups: [&#34;k8s.cni.cncf.io&#34;]
</span></span></span><span class=line><span class=cl><span class=s>  resources:
</span></span></span><span class=line><span class=cl><span class=s>  - &#39;*&#39;
</span></span></span><span class=line><span class=cl><span class=s>  verbs:
</span></span></span><span class=line><span class=cl><span class=s>  - &#39;*&#39;
</span></span></span><span class=line><span class=cl><span class=s>- apiGroups:
</span></span></span><span class=line><span class=cl><span class=s>  - &#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s>  resources:
</span></span></span><span class=line><span class=cl><span class=s>  - pods
</span></span></span><span class=line><span class=cl><span class=s>  - pods/status
</span></span></span><span class=line><span class=cl><span class=s>  verbs:
</span></span></span><span class=line><span class=cl><span class=s>  - get
</span></span></span><span class=line><span class=cl><span class=s>  - update
</span></span></span><span class=line><span class=cl><span class=s>- apiGroups:
</span></span></span><span class=line><span class=cl><span class=s>  - &#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s>  - events.k8s.io
</span></span></span><span class=line><span class=cl><span class=s>  resources:
</span></span></span><span class=line><span class=cl><span class=s>  - events
</span></span></span><span class=line><span class=cl><span class=s>  verbs:
</span></span></span><span class=line><span class=cl><span class=s>  - create
</span></span></span><span class=line><span class=cl><span class=s>  - patch
</span></span></span><span class=line><span class=cl><span class=s>  - update
</span></span></span><span class=line><span class=cl><span class=s>---
</span></span></span><span class=line><span class=cl><span class=s>apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span class=line><span class=cl><span class=s>kind: ClusterRoleBinding
</span></span></span><span class=line><span class=cl><span class=s>metadata:
</span></span></span><span class=line><span class=cl><span class=s>  name: multus
</span></span></span><span class=line><span class=cl><span class=s>roleRef:
</span></span></span><span class=line><span class=cl><span class=s>  apiGroup: rbac.authorization.k8s.io
</span></span></span><span class=line><span class=cl><span class=s>  kind: ClusterRole
</span></span></span><span class=line><span class=cl><span class=s>  name: multus
</span></span></span><span class=line><span class=cl><span class=s>subjects:
</span></span></span><span class=line><span class=cl><span class=s>- kind: ServiceAccount
</span></span></span><span class=line><span class=cl><span class=s>  name: multus
</span></span></span><span class=line><span class=cl><span class=s>  namespace: multus-system
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kubectl apply -f multus-rbac.yaml</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 创建 Multus DaemonSet</span>
</span></span><span class=line><span class=cl>cat &gt; multus-daemonset.yaml <span class=s>&lt;&lt; &#39;EOF&#39;
</span></span></span><span class=line><span class=cl><span class=s>apiVersion: apps/v1
</span></span></span><span class=line><span class=cl><span class=s>kind: DaemonSet
</span></span></span><span class=line><span class=cl><span class=s>metadata:
</span></span></span><span class=line><span class=cl><span class=s>  name: kube-multus-ds
</span></span></span><span class=line><span class=cl><span class=s>  namespace: multus-system
</span></span></span><span class=line><span class=cl><span class=s>  labels:
</span></span></span><span class=line><span class=cl><span class=s>    tier: node
</span></span></span><span class=line><span class=cl><span class=s>    app: multus
</span></span></span><span class=line><span class=cl><span class=s>    name: multus
</span></span></span><span class=line><span class=cl><span class=s>spec:
</span></span></span><span class=line><span class=cl><span class=s>  selector:
</span></span></span><span class=line><span class=cl><span class=s>    matchLabels:
</span></span></span><span class=line><span class=cl><span class=s>      name: multus
</span></span></span><span class=line><span class=cl><span class=s>  updateStrategy:
</span></span></span><span class=line><span class=cl><span class=s>    type: RollingUpdate
</span></span></span><span class=line><span class=cl><span class=s>  template:
</span></span></span><span class=line><span class=cl><span class=s>    metadata:
</span></span></span><span class=line><span class=cl><span class=s>      labels:
</span></span></span><span class=line><span class=cl><span class=s>        tier: node
</span></span></span><span class=line><span class=cl><span class=s>        app: multus
</span></span></span><span class=line><span class=cl><span class=s>        name: multus
</span></span></span><span class=line><span class=cl><span class=s>    spec:
</span></span></span><span class=line><span class=cl><span class=s>      hostNetwork: true
</span></span></span><span class=line><span class=cl><span class=s>      tolerations:
</span></span></span><span class=line><span class=cl><span class=s>      - operator: Exists
</span></span></span><span class=line><span class=cl><span class=s>        effect: NoSchedule
</span></span></span><span class=line><span class=cl><span class=s>      - operator: Exists
</span></span></span><span class=line><span class=cl><span class=s>        effect: NoExecute
</span></span></span><span class=line><span class=cl><span class=s>      serviceAccountName: multus
</span></span></span><span class=line><span class=cl><span class=s>      containers:
</span></span></span><span class=line><span class=cl><span class=s>      - name: kube-multus
</span></span></span><span class=line><span class=cl><span class=s>        image: ghcr.io/k8snetworkplumbingwg/multus-cni:v4.0.2
</span></span></span><span class=line><span class=cl><span class=s>        command: [&#34;/entrypoint.sh&#34;]
</span></span></span><span class=line><span class=cl><span class=s>        args:
</span></span></span><span class=line><span class=cl><span class=s>        - &#34;--multus-conf-file=auto&#34;
</span></span></span><span class=line><span class=cl><span class=s>        - &#34;--multus-autoconfig-dir=/host/etc/cni/net.d&#34;
</span></span></span><span class=line><span class=cl><span class=s>        - &#34;--cni-conf-dir=/host/etc/cni/net.d&#34;
</span></span></span><span class=line><span class=cl><span class=s>        - &#34;--multus-kubeconfig-file-host=/etc/cni/net.d/multus.d/multus.kubeconfig&#34;
</span></span></span><span class=line><span class=cl><span class=s>        - &#34;--cleanup-config-on-exit=true&#34;
</span></span></span><span class=line><span class=cl><span class=s>        resources:
</span></span></span><span class=line><span class=cl><span class=s>          requests:
</span></span></span><span class=line><span class=cl><span class=s>            cpu: &#34;100m&#34;
</span></span></span><span class=line><span class=cl><span class=s>            memory: &#34;50Mi&#34;
</span></span></span><span class=line><span class=cl><span class=s>          limits:
</span></span></span><span class=line><span class=cl><span class=s>            cpu: &#34;100m&#34;
</span></span></span><span class=line><span class=cl><span class=s>            memory: &#34;50Mi&#34;
</span></span></span><span class=line><span class=cl><span class=s>        securityContext:
</span></span></span><span class=line><span class=cl><span class=s>          privileged: true
</span></span></span><span class=line><span class=cl><span class=s>        volumeMounts:
</span></span></span><span class=line><span class=cl><span class=s>        - name: cni
</span></span></span><span class=line><span class=cl><span class=s>          mountPath: /host/etc/cni/net.d
</span></span></span><span class=line><span class=cl><span class=s>        - name: cnibin
</span></span></span><span class=line><span class=cl><span class=s>          mountPath: /host/opt/cni/bin
</span></span></span><span class=line><span class=cl><span class=s>        - name: multus-cfg
</span></span></span><span class=line><span class=cl><span class=s>          mountPath: /tmp/multus-conf
</span></span></span><span class=line><span class=cl><span class=s>      terminationGracePeriodSeconds: 10
</span></span></span><span class=line><span class=cl><span class=s>      volumes:
</span></span></span><span class=line><span class=cl><span class=s>      - name: cni
</span></span></span><span class=line><span class=cl><span class=s>        hostPath:
</span></span></span><span class=line><span class=cl><span class=s>          path: /etc/cni/net.d
</span></span></span><span class=line><span class=cl><span class=s>      - name: cnibin
</span></span></span><span class=line><span class=cl><span class=s>        hostPath:
</span></span></span><span class=line><span class=cl><span class=s>          path: /opt/cni/bin
</span></span></span><span class=line><span class=cl><span class=s>      - name: multus-cfg
</span></span></span><span class=line><span class=cl><span class=s>        configMap:
</span></span></span><span class=line><span class=cl><span class=s>          name: multus-cni-config
</span></span></span><span class=line><span class=cl><span class=s>          items:
</span></span></span><span class=line><span class=cl><span class=s>          - key: cni-conf.json
</span></span></span><span class=line><span class=cl><span class=s>            path: 70-multus.conf
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kubectl apply -f multus-daemonset.yaml</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=3-验证-multus-部署><span>3. 验证 Multus 部署</span>
<a href=#3-%e9%aa%8c%e8%af%81-multus-%e9%83%a8%e7%bd%b2 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 等待 Multus Pod 就绪</span>
</span></span><span class=line><span class=cl>kubectl <span class=nb>wait</span> --for<span class=o>=</span><span class=nv>condition</span><span class=o>=</span>Ready pods -l <span class=nv>name</span><span class=o>=</span>multus -n multus-system --timeout<span class=o>=</span>300s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 检查 Multus 状态</span>
</span></span><span class=line><span class=cl>kubectl get pods -n multus-system
</span></span><span class=line><span class=cl>kubectl logs -n multus-system -l <span class=nv>name</span><span class=o>=</span>multus
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 验证 CNI 配置</span>
</span></span><span class=line><span class=cl><span class=k>for</span> node in <span class=k>$(</span>kubectl get nodes -o name <span class=p>|</span> cut -d/ -f2<span class=k>)</span><span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;=== Node: </span><span class=nv>$node</span><span class=s2> ===&#34;</span>
</span></span><span class=line><span class=cl>    docker <span class=nb>exec</span> <span class=nv>$node</span> ls -la /etc/cni/net.d/
</span></span><span class=line><span class=cl><span class=k>done</span></span></span></code></pre></td></tr></table></div></div><h2 class=heading-element id=网络附件定义创建><span>网络附件定义创建</span>
<a href=#%e7%bd%91%e7%bb%9c%e9%99%84%e4%bb%b6%e5%ae%9a%e4%b9%89%e5%88%9b%e5%bb%ba class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=1-创建测试命名空间><span>1. 创建测试命名空间</span>
<a href=#1-%e5%88%9b%e5%bb%ba%e6%b5%8b%e8%af%95%e5%91%bd%e5%90%8d%e7%a9%ba%e9%97%b4 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 创建业务命名空间</span>
</span></span><span class=line><span class=cl>kubectl create namespace business-apps
</span></span><span class=line><span class=cl>kubectl create namespace storage-apps
</span></span><span class=line><span class=cl>kubectl create namespace test-apps
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 添加命名空间标签</span>
</span></span><span class=line><span class=cl>kubectl label namespace business-apps <span class=nv>name</span><span class=o>=</span>business-apps
</span></span><span class=line><span class=cl>kubectl label namespace storage-apps <span class=nv>name</span><span class=o>=</span>storage-apps
</span></span><span class=line><span class=cl>kubectl label namespace test-apps <span class=nv>name</span><span class=o>=</span>test-apps</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=2-创建-macvlan-网络模拟><span>2. 创建 MacVLAN 网络（模拟）</span>
<a href=#2-%e5%88%9b%e5%bb%ba-macvlan-%e7%bd%91%e7%bb%9c%e6%a8%a1%e6%8b%9f class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># macvlan-network.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;k8s.cni.cncf.io/v1&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>NetworkAttachmentDefinition</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>macvlan-network</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>business-apps</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>config</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;{
</span></span></span><span class=line><span class=cl><span class=s1>    &#34;cniVersion&#34;: &#34;0.3.1&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>    &#34;type&#34;: &#34;macvlan&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>    &#34;master&#34;: &#34;eth0&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>    &#34;mode&#34;: &#34;bridge&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>    &#34;ipam&#34;: {
</span></span></span><span class=line><span class=cl><span class=s1>      &#34;type&#34;: &#34;host-local&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>      &#34;subnet&#34;: &#34;192.168.100.0/24&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>      &#34;rangeStart&#34;: &#34;192.168.100.10&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>      &#34;rangeEnd&#34;: &#34;192.168.100.100&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>      &#34;gateway&#34;: &#34;192.168.100.1&#34;
</span></span></span><span class=line><span class=cl><span class=s1>    }
</span></span></span><span class=line><span class=cl><span class=s1>  }&#39;</span></span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=3-创建-bridge-网络><span>3. 创建 Bridge 网络</span>
<a href=#3-%e5%88%9b%e5%bb%ba-bridge-%e7%bd%91%e7%bb%9c class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># bridge-network.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;k8s.cni.cncf.io/v1&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>NetworkAttachmentDefinition</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>bridge-network</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>storage-apps</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>config</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;{
</span></span></span><span class=line><span class=cl><span class=s1>    &#34;cniVersion&#34;: &#34;0.3.1&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>    &#34;type&#34;: &#34;bridge&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>    &#34;bridge&#34;: &#34;br-storage&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>    &#34;isGateway&#34;: true,
</span></span></span><span class=line><span class=cl><span class=s1>    &#34;isDefaultGateway&#34;: false,
</span></span></span><span class=line><span class=cl><span class=s1>    &#34;ipMasq&#34;: true,
</span></span></span><span class=line><span class=cl><span class=s1>    &#34;hairpinMode&#34;: true,
</span></span></span><span class=line><span class=cl><span class=s1>    &#34;ipam&#34;: {
</span></span></span><span class=line><span class=cl><span class=s1>      &#34;type&#34;: &#34;host-local&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>      &#34;subnet&#34;: &#34;172.16.0.0/24&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>      &#34;rangeStart&#34;: &#34;172.16.0.10&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>      &#34;rangeEnd&#34;: &#34;172.16.0.100&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>      &#34;gateway&#34;: &#34;172.16.0.1&#34;
</span></span></span><span class=line><span class=cl><span class=s1>    }
</span></span></span><span class=line><span class=cl><span class=s1>  }&#39;</span></span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=4-创建-host-local-网络><span>4. 创建 Host-Local 网络</span>
<a href=#4-%e5%88%9b%e5%bb%ba-host-local-%e7%bd%91%e7%bb%9c class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># host-local-network.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;k8s.cni.cncf.io/v1&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>NetworkAttachmentDefinition</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>host-local-network</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>test-apps</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>config</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;{
</span></span></span><span class=line><span class=cl><span class=s1>    &#34;cniVersion&#34;: &#34;0.3.1&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>    &#34;type&#34;: &#34;host-local&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>    &#34;subnet&#34;: &#34;10.100.0.0/24&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>    &#34;rangeStart&#34;: &#34;10.100.0.10&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>    &#34;rangeEnd&#34;: &#34;10.100.0.100&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>    &#34;gateway&#34;: &#34;10.100.0.1&#34;
</span></span></span><span class=line><span class=cl><span class=s1>  }&#39;</span></span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=5-应用网络附件定义><span>5. 应用网络附件定义</span>
<a href=#5-%e5%ba%94%e7%94%a8%e7%bd%91%e7%bb%9c%e9%99%84%e4%bb%b6%e5%ae%9a%e4%b9%89 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 应用所有网络附件定义</span>
</span></span><span class=line><span class=cl>kubectl apply -f macvlan-network.yaml
</span></span><span class=line><span class=cl>kubectl apply -f bridge-network.yaml
</span></span><span class=line><span class=cl>kubectl apply -f host-local-network.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 验证网络附件定义</span>
</span></span><span class=line><span class=cl>kubectl get network-attachment-definitions --all-namespaces
</span></span><span class=line><span class=cl>kubectl describe network-attachment-definitions macvlan-network -n business-apps</span></span></code></pre></td></tr></table></div></div><h2 class=heading-element id=验证应用部署><span>验证应用部署</span>
<a href=#%e9%aa%8c%e8%af%81%e5%ba%94%e7%94%a8%e9%83%a8%e7%bd%b2 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=1-单网络测试应用><span>1. 单网络测试应用</span>
<a href=#1-%e5%8d%95%e7%bd%91%e7%bb%9c%e6%b5%8b%e8%af%95%e5%ba%94%e7%94%a8 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># single-network-test.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>single-network-test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>test-apps</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>single-network-test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>single-network-test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>test-container</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>busybox:1.35</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;sleep&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;3600&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=l>50m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=l>64Mi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=l>100m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=l>128Mi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>single-network-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>test-apps</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>single-network-test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ClusterIP</span></span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=2-多网络测试应用><span>2. 多网络测试应用</span>
<a href=#2-%e5%a4%9a%e7%bd%91%e7%bb%9c%e6%b5%8b%e8%af%95%e5%ba%94%e7%94%a8 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># multi-network-test.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>multi-network-test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>business-apps</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>multi-network-test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>multi-network-test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>k8s.v1.cni.cncf.io/networks</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          [
</span></span></span><span class=line><span class=cl><span class=sd>            {
</span></span></span><span class=line><span class=cl><span class=sd>              &#34;name&#34;: &#34;macvlan-network&#34;,
</span></span></span><span class=line><span class=cl><span class=sd>              &#34;interface&#34;: &#34;net1&#34;
</span></span></span><span class=line><span class=cl><span class=sd>            }
</span></span></span><span class=line><span class=cl><span class=sd>          ]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>test-container</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nicolaka/netshoot:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;sleep&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;3600&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=l>100m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=l>128Mi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=l>200m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=l>256Mi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>multi-network-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>business-apps</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>multi-network-test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ClusterIP</span></span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=3-存储网络测试应用><span>3. 存储网络测试应用</span>
<a href=#3-%e5%ad%98%e5%82%a8%e7%bd%91%e7%bb%9c%e6%b5%8b%e8%af%95%e5%ba%94%e7%94%a8 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># storage-network-test.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>storage-network-test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>storage-apps</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>storage-network-test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>storage-network-test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>k8s.v1.cni.cncf.io/networks</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          [
</span></span></span><span class=line><span class=cl><span class=sd>            {
</span></span></span><span class=line><span class=cl><span class=sd>              &#34;name&#34;: &#34;bridge-network&#34;,
</span></span></span><span class=line><span class=cl><span class=sd>              &#34;interface&#34;: &#34;storage0&#34;
</span></span></span><span class=line><span class=cl><span class=sd>            }
</span></span></span><span class=line><span class=cl><span class=sd>          ]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>storage-container</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>minio/minio:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>command</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>/bin/bash</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- -<span class=l>c</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>args</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>minio server /data --console-address &#34;:9001&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>9000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>api</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>9001</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>console</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=l>200m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=l>512Mi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=l>500m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=l>1Gi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>emptyDir</span><span class=p>:</span><span class=w> </span>{}</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=4-部署测试应用><span>4. 部署测试应用</span>
<a href=#4-%e9%83%a8%e7%bd%b2%e6%b5%8b%e8%af%95%e5%ba%94%e7%94%a8 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 部署所有测试应用</span>
</span></span><span class=line><span class=cl>kubectl apply -f single-network-test.yaml
</span></span><span class=line><span class=cl>kubectl apply -f multi-network-test.yaml
</span></span><span class=line><span class=cl>kubectl apply -f storage-network-test.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 等待 Pod 就绪</span>
</span></span><span class=line><span class=cl>kubectl <span class=nb>wait</span> --for<span class=o>=</span><span class=nv>condition</span><span class=o>=</span>Ready pods --all --all-namespaces --timeout<span class=o>=</span>300s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 检查 Pod 状态</span>
</span></span><span class=line><span class=cl>kubectl get pods --all-namespaces -o wide</span></span></code></pre></td></tr></table></div></div><h2 class=heading-element id=网络验证测试><span>网络验证测试</span>
<a href=#%e7%bd%91%e7%bb%9c%e9%aa%8c%e8%af%81%e6%b5%8b%e8%af%95 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=1-基础网络连通性测试><span>1. 基础网络连通性测试</span>
<a href=#1-%e5%9f%ba%e7%a1%80%e7%bd%91%e7%bb%9c%e8%bf%9e%e9%80%9a%e6%80%a7%e6%b5%8b%e8%af%95 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 创建网络测试脚本</span>
</span></span><span class=line><span class=cl>cat &gt; network-verification.sh <span class=s>&lt;&lt; &#39;EOF&#39;
</span></span></span><span class=line><span class=cl><span class=s>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;=== 1. 基础网络连通性测试 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 获取测试 Pod
</span></span></span><span class=line><span class=cl><span class=s>SINGLE_POD=$(kubectl get pods -n test-apps -l app=single-network-test -o jsonpath=&#39;{.items[0].metadata.name}&#39;)
</span></span></span><span class=line><span class=cl><span class=s>MULTI_POD=$(kubectl get pods -n business-apps -l app=multi-network-test -o jsonpath=&#39;{.items[0].metadata.name}&#39;)
</span></span></span><span class=line><span class=cl><span class=s>STORAGE_POD=$(kubectl get pods -n storage-apps -l app=storage-network-test -o jsonpath=&#39;{.items[0].metadata.name}&#39;)
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;测试 Pod:&#34;
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;  Single Network: $SINGLE_POD&#34;
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;  Multi Network: $MULTI_POD&#34;
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;  Storage Network: $STORAGE_POD&#34;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 2. 网络接口检查 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 检查单网络 Pod
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;单网络 Pod 接口:&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl exec -n test-apps $SINGLE_POD -- ip addr show
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 检查多网络 Pod
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n多网络 Pod 接口:&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl exec -n business-apps $MULTI_POD -- ip addr show
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 检查存储网络 Pod
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n存储网络 Pod 接口:&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl exec -n storage-apps $STORAGE_POD -- ip addr show
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 3. 路由表检查 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 检查路由表
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;多网络 Pod 路由表:&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl exec -n business-apps $MULTI_POD -- ip route show
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 4. DNS 解析测试 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># DNS 解析测试
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;DNS 解析测试:&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl exec -n test-apps $SINGLE_POD -- nslookup kubernetes.default.svc.cluster.local
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 5. 服务连通性测试 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 服务连通性测试
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;集群内服务访问测试:&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl exec -n test-apps $SINGLE_POD -- wget -qO- --timeout=5 http://single-network-service.test-apps.svc.cluster.local || echo &#34;连接失败&#34;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 6. 跨命名空间连通性测试 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 跨命名空间连通性
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;跨命名空间访问测试:&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl exec -n business-apps $MULTI_POD -- wget -qO- --timeout=5 http://single-network-service.test-apps.svc.cluster.local || echo &#34;连接失败&#34;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 验证完成 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>chmod +x network-verification.sh
</span></span><span class=line><span class=cl>./network-verification.sh</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=2-多网络接口验证><span>2. 多网络接口验证</span>
<a href=#2-%e5%a4%9a%e7%bd%91%e7%bb%9c%e6%8e%a5%e5%8f%a3%e9%aa%8c%e8%af%81 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 详细的多网络接口验证</span>
</span></span><span class=line><span class=cl>cat &gt; multi-network-verification.sh <span class=s>&lt;&lt; &#39;EOF&#39;
</span></span></span><span class=line><span class=cl><span class=s>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;=== 多网络接口详细验证 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 获取多网络 Pod
</span></span></span><span class=line><span class=cl><span class=s>MULTI_POD=$(kubectl get pods -n business-apps -l app=multi-network-test -o jsonpath=&#39;{.items[0].metadata.name}&#39;)
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>if [ -z &#34;$MULTI_POD&#34; ]; then
</span></span></span><span class=line><span class=cl><span class=s>    echo &#34;未找到多网络测试 Pod&#34;
</span></span></span><span class=line><span class=cl><span class=s>    exit 1
</span></span></span><span class=line><span class=cl><span class=s>fi
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;测试 Pod: $MULTI_POD&#34;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 1. 网络接口详情 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl exec -n business-apps $MULTI_POD -- ip -d addr show
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 2. 网络接口统计 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl exec -n business-apps $MULTI_POD -- ip -s link show
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 3. 路由表详情 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl exec -n business-apps $MULTI_POD -- ip route show table all
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 4. ARP 表 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl exec -n business-apps $MULTI_POD -- arp -a
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 5. 网络命名空间 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl exec -n business-apps $MULTI_POD -- ip netns list
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 6. 网络连通性测试 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 测试默认接口连通性
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;默认接口连通性:&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl exec -n business-apps $MULTI_POD -- ping -c 3 kubernetes.default.svc.cluster.local
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 测试附加接口（如果配置了 IP）
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n检查附加网络接口配置:&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl exec -n business-apps $MULTI_POD -- ip addr show net1 2&gt;/dev/null || echo &#34;net1 接口未配置或不存在&#34;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 验证完成 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>chmod +x multi-network-verification.sh
</span></span><span class=line><span class=cl>./multi-network-verification.sh</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=3-网络性能测试><span>3. 网络性能测试</span>
<a href=#3-%e7%bd%91%e7%bb%9c%e6%80%a7%e8%83%bd%e6%b5%8b%e8%af%95 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 网络性能测试</span>
</span></span><span class=line><span class=cl>cat &gt; network-performance-test.sh <span class=s>&lt;&lt; &#39;EOF&#39;
</span></span></span><span class=line><span class=cl><span class=s>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;=== 网络性能测试 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 部署 iperf3 服务器
</span></span></span><span class=line><span class=cl><span class=s>cat &gt; iperf3-server.yaml &lt;&lt; &#39;YAML&#39;
</span></span></span><span class=line><span class=cl><span class=s>apiVersion: apps/v1
</span></span></span><span class=line><span class=cl><span class=s>kind: Deployment
</span></span></span><span class=line><span class=cl><span class=s>metadata:
</span></span></span><span class=line><span class=cl><span class=s>  name: iperf3-server
</span></span></span><span class=line><span class=cl><span class=s>  namespace: test-apps
</span></span></span><span class=line><span class=cl><span class=s>spec:
</span></span></span><span class=line><span class=cl><span class=s>  replicas: 1
</span></span></span><span class=line><span class=cl><span class=s>  selector:
</span></span></span><span class=line><span class=cl><span class=s>    matchLabels:
</span></span></span><span class=line><span class=cl><span class=s>      app: iperf3-server
</span></span></span><span class=line><span class=cl><span class=s>  template:
</span></span></span><span class=line><span class=cl><span class=s>    metadata:
</span></span></span><span class=line><span class=cl><span class=s>      labels:
</span></span></span><span class=line><span class=cl><span class=s>        app: iperf3-server
</span></span></span><span class=line><span class=cl><span class=s>    spec:
</span></span></span><span class=line><span class=cl><span class=s>      containers:
</span></span></span><span class=line><span class=cl><span class=s>      - name: iperf3-server
</span></span></span><span class=line><span class=cl><span class=s>        image: networkstatic/iperf3:latest
</span></span></span><span class=line><span class=cl><span class=s>        command: [&#34;iperf3&#34;, &#34;-s&#34;]
</span></span></span><span class=line><span class=cl><span class=s>        ports:
</span></span></span><span class=line><span class=cl><span class=s>        - containerPort: 5201
</span></span></span><span class=line><span class=cl><span class=s>---
</span></span></span><span class=line><span class=cl><span class=s>apiVersion: v1
</span></span></span><span class=line><span class=cl><span class=s>kind: Service
</span></span></span><span class=line><span class=cl><span class=s>metadata:
</span></span></span><span class=line><span class=cl><span class=s>  name: iperf3-server-service
</span></span></span><span class=line><span class=cl><span class=s>  namespace: test-apps
</span></span></span><span class=line><span class=cl><span class=s>spec:
</span></span></span><span class=line><span class=cl><span class=s>  selector:
</span></span></span><span class=line><span class=cl><span class=s>    app: iperf3-server
</span></span></span><span class=line><span class=cl><span class=s>  ports:
</span></span></span><span class=line><span class=cl><span class=s>  - port: 5201
</span></span></span><span class=line><span class=cl><span class=s>    targetPort: 5201
</span></span></span><span class=line><span class=cl><span class=s>  type: ClusterIP
</span></span></span><span class=line><span class=cl><span class=s>YAML
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>kubectl apply -f iperf3-server.yaml
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 等待服务就绪
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;等待 iperf3 服务就绪...&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl wait --for=condition=Ready pods -l app=iperf3-server -n test-apps --timeout=60s
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 获取客户端 Pod
</span></span></span><span class=line><span class=cl><span class=s>CLIENT_POD=$(kubectl get pods -n business-apps -l app=multi-network-test -o jsonpath=&#39;{.items[0].metadata.name}&#39;)
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>if [ -n &#34;$CLIENT_POD&#34; ]; then
</span></span></span><span class=line><span class=cl><span class=s>    echo &#34;\n=== 执行性能测试 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>    echo &#34;客户端 Pod: $CLIENT_POD&#34;
</span></span></span><span class=line><span class=cl><span class=s>    
</span></span></span><span class=line><span class=cl><span class=s>    # TCP 性能测试
</span></span></span><span class=line><span class=cl><span class=s>    echo &#34;\nTCP 性能测试 (10秒):&#34;
</span></span></span><span class=line><span class=cl><span class=s>    kubectl exec -n business-apps $CLIENT_POD -- iperf3 -c iperf3-server-service.test-apps.svc.cluster.local -t 10
</span></span></span><span class=line><span class=cl><span class=s>    
</span></span></span><span class=line><span class=cl><span class=s>    # UDP 性能测试
</span></span></span><span class=line><span class=cl><span class=s>    echo &#34;\nUDP 性能测试 (10秒):&#34;
</span></span></span><span class=line><span class=cl><span class=s>    kubectl exec -n business-apps $CLIENT_POD -- iperf3 -c iperf3-server-service.test-apps.svc.cluster.local -u -t 10
</span></span></span><span class=line><span class=cl><span class=s>else
</span></span></span><span class=line><span class=cl><span class=s>    echo &#34;未找到客户端 Pod&#34;
</span></span></span><span class=line><span class=cl><span class=s>fi
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 性能测试完成 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>chmod +x network-performance-test.sh
</span></span><span class=line><span class=cl>./network-performance-test.sh</span></span></code></pre></td></tr></table></div></div><h2 class=heading-element id=故障排查和调试><span>故障排查和调试</span>
<a href=#%e6%95%85%e9%9a%9c%e6%8e%92%e6%9f%a5%e5%92%8c%e8%b0%83%e8%af%95 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=1-集群状态检查><span>1. 集群状态检查</span>
<a href=#1-%e9%9b%86%e7%be%a4%e7%8a%b6%e6%80%81%e6%a3%80%e6%9f%a5 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 创建集群诊断脚本</span>
</span></span><span class=line><span class=cl>cat &gt; cluster-diagnosis.sh <span class=s>&lt;&lt; &#39;EOF&#39;
</span></span></span><span class=line><span class=cl><span class=s>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;=== Kind 集群诊断 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 1. 集群基本信息 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>kind get clusters
</span></span></span><span class=line><span class=cl><span class=s>kubectl cluster-info
</span></span></span><span class=line><span class=cl><span class=s>kubectl version --short
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 2. 节点状态 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl get nodes -o wide
</span></span></span><span class=line><span class=cl><span class=s>kubectl describe nodes
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 3. 系统 Pod 状态 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl get pods --all-namespaces
</span></span></span><span class=line><span class=cl><span class=s>kubectl get pods -n kube-system -o wide
</span></span></span><span class=line><span class=cl><span class=s>kubectl get pods -n kube-flannel -o wide
</span></span></span><span class=line><span class=cl><span class=s>kubectl get pods -n multus-system -o wide
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 4. 网络配置检查 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>for node in $(kubectl get nodes -o name | cut -d/ -f2); do
</span></span></span><span class=line><span class=cl><span class=s>    echo &#34;\n--- Node: $node ---&#34;
</span></span></span><span class=line><span class=cl><span class=s>    echo &#34;CNI 配置:&#34;
</span></span></span><span class=line><span class=cl><span class=s>    docker exec $node ls -la /etc/cni/net.d/
</span></span></span><span class=line><span class=cl><span class=s>    echo &#34;\nCNI 二进制:&#34;
</span></span></span><span class=line><span class=cl><span class=s>    docker exec $node ls -la /opt/cni/bin/
</span></span></span><span class=line><span class=cl><span class=s>    echo &#34;\n网络接口:&#34;
</span></span></span><span class=line><span class=cl><span class=s>    docker exec $node ip addr show
</span></span></span><span class=line><span class=cl><span class=s>done
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 5. 网络附件定义 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl get network-attachment-definitions --all-namespaces
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 6. 服务和端点 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl get services --all-namespaces
</span></span></span><span class=line><span class=cl><span class=s>kubectl get endpoints --all-namespaces
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 7. 事件日志 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl get events --all-namespaces --sort-by=&#39;.lastTimestamp&#39; | tail -20
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 诊断完成 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>chmod +x cluster-diagnosis.sh
</span></span><span class=line><span class=cl>./cluster-diagnosis.sh</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=2-网络问题排查><span>2. 网络问题排查</span>
<a href=#2-%e7%bd%91%e7%bb%9c%e9%97%ae%e9%a2%98%e6%8e%92%e6%9f%a5 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 网络问题排查脚本</span>
</span></span><span class=line><span class=cl>cat &gt; network-troubleshoot.sh <span class=s>&lt;&lt; &#39;EOF&#39;
</span></span></span><span class=line><span class=cl><span class=s>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;=== 网络问题排查 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 1. CNI 插件状态 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 检查 Flannel 状态
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;Flannel 状态:&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl get pods -n kube-flannel
</span></span></span><span class=line><span class=cl><span class=s>kubectl logs -n kube-flannel -l app=flannel --tail=50
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 检查 Multus 状态
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\nMultus 状态:&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl get pods -n multus-system
</span></span></span><span class=line><span class=cl><span class=s>kubectl logs -n multus-system -l name=multus --tail=50
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 2. 网络配置验证 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 验证 CNI 配置文件
</span></span></span><span class=line><span class=cl><span class=s>for node in $(kubectl get nodes -o name | cut -d/ -f2); do
</span></span></span><span class=line><span class=cl><span class=s>    echo &#34;\n--- Node: $node ---&#34;
</span></span></span><span class=line><span class=cl><span class=s>    echo &#34;CNI 配置文件:&#34;
</span></span></span><span class=line><span class=cl><span class=s>    docker exec $node find /etc/cni/net.d/ -name &#34;*.conf*&#34; -exec cat {} \;
</span></span></span><span class=line><span class=cl><span class=s>done
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 3. Pod 网络状态 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 检查 Pod 网络状态
</span></span></span><span class=line><span class=cl><span class=s>for ns in $(kubectl get namespaces -o name | cut -d/ -f2); do
</span></span></span><span class=line><span class=cl><span class=s>    pods=$(kubectl get pods -n $ns -o name 2&gt;/dev/null)
</span></span></span><span class=line><span class=cl><span class=s>    if [ -n &#34;$pods&#34; ]; then
</span></span></span><span class=line><span class=cl><span class=s>        echo &#34;\n--- Namespace: $ns ---&#34;
</span></span></span><span class=line><span class=cl><span class=s>        for pod in $pods; do
</span></span></span><span class=line><span class=cl><span class=s>            pod_name=$(echo $pod | cut -d/ -f2)
</span></span></span><span class=line><span class=cl><span class=s>            echo &#34;Pod: $pod_name&#34;
</span></span></span><span class=line><span class=cl><span class=s>            kubectl exec -n $ns $pod_name -- ip addr show 2&gt;/dev/null || echo &#34;  无法访问 Pod 网络接口&#34;
</span></span></span><span class=line><span class=cl><span class=s>        done
</span></span></span><span class=line><span class=cl><span class=s>    fi
</span></span></span><span class=line><span class=cl><span class=s>done
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 4. 网络连通性测试 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 创建临时测试 Pod
</span></span></span><span class=line><span class=cl><span class=s>kubectl run network-test --image=busybox --rm -it --restart=Never -- /bin/sh -c &#34;
</span></span></span><span class=line><span class=cl><span class=s>    echo &#39;测试 DNS 解析:&#39;
</span></span></span><span class=line><span class=cl><span class=s>    nslookup kubernetes.default.svc.cluster.local
</span></span></span><span class=line><span class=cl><span class=s>    echo &#39;测试网络连通性:&#39;
</span></span></span><span class=line><span class=cl><span class=s>    ping -c 3 kubernetes.default.svc.cluster.local
</span></span></span><span class=line><span class=cl><span class=s>&#34; 2&gt;/dev/null || echo &#34;网络测试失败&#34;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 排查完成 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>chmod +x network-troubleshoot.sh
</span></span><span class=line><span class=cl>./network-troubleshoot.sh</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=3-日志收集><span>3. 日志收集</span>
<a href=#3-%e6%97%a5%e5%bf%97%e6%94%b6%e9%9b%86 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 日志收集脚本</span>
</span></span><span class=line><span class=cl>cat &gt; collect-logs.sh <span class=s>&lt;&lt; &#39;EOF&#39;
</span></span></span><span class=line><span class=cl><span class=s>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>LOG_DIR=&#34;kind-logs-$(date +%Y%m%d-%H%M%S)&#34;
</span></span></span><span class=line><span class=cl><span class=s>mkdir -p $LOG_DIR
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;=== 收集 Kind 集群日志 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;日志目录: $LOG_DIR&#34;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 收集集群信息
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;收集集群信息...&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl cluster-info &gt; $LOG_DIR/cluster-info.txt
</span></span></span><span class=line><span class=cl><span class=s>kubectl get nodes -o wide &gt; $LOG_DIR/nodes.txt
</span></span></span><span class=line><span class=cl><span class=s>kubectl get pods --all-namespaces -o wide &gt; $LOG_DIR/pods.txt
</span></span></span><span class=line><span class=cl><span class=s>kubectl get services --all-namespaces &gt; $LOG_DIR/services.txt
</span></span></span><span class=line><span class=cl><span class=s>kubectl get network-attachment-definitions --all-namespaces &gt; $LOG_DIR/network-attachments.txt
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 收集系统 Pod 日志
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;收集系统 Pod 日志...&#34;
</span></span></span><span class=line><span class=cl><span class=s>mkdir -p $LOG_DIR/pod-logs
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># Flannel 日志
</span></span></span><span class=line><span class=cl><span class=s>kubectl logs -n kube-flannel -l app=flannel &gt; $LOG_DIR/pod-logs/flannel.log
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># Multus 日志
</span></span></span><span class=line><span class=cl><span class=s>kubectl logs -n multus-system -l name=multus &gt; $LOG_DIR/pod-logs/multus.log
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 测试应用日志
</span></span></span><span class=line><span class=cl><span class=s>for ns in test-apps business-apps storage-apps; do
</span></span></span><span class=line><span class=cl><span class=s>    pods=$(kubectl get pods -n $ns -o name 2&gt;/dev/null)
</span></span></span><span class=line><span class=cl><span class=s>    if [ -n &#34;$pods&#34; ]; then
</span></span></span><span class=line><span class=cl><span class=s>        for pod in $pods; do
</span></span></span><span class=line><span class=cl><span class=s>            pod_name=$(echo $pod | cut -d/ -f2)
</span></span></span><span class=line><span class=cl><span class=s>            kubectl logs -n $ns $pod_name &gt; $LOG_DIR/pod-logs/${ns}-${pod_name}.log 2&gt;/dev/null
</span></span></span><span class=line><span class=cl><span class=s>        done
</span></span></span><span class=line><span class=cl><span class=s>    fi
</span></span></span><span class=line><span class=cl><span class=s>done
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 收集事件
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;收集事件日志...&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl get events --all-namespaces --sort-by=&#39;.lastTimestamp&#39; &gt; $LOG_DIR/events.txt
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 收集节点配置
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;收集节点配置...&#34;
</span></span></span><span class=line><span class=cl><span class=s>mkdir -p $LOG_DIR/node-configs
</span></span></span><span class=line><span class=cl><span class=s>for node in $(kubectl get nodes -o name | cut -d/ -f2); do
</span></span></span><span class=line><span class=cl><span class=s>    echo &#34;收集节点 $node 配置...&#34;
</span></span></span><span class=line><span class=cl><span class=s>    docker exec $node ls -la /etc/cni/net.d/ &gt; $LOG_DIR/node-configs/${node}-cni-configs.txt
</span></span></span><span class=line><span class=cl><span class=s>    docker exec $node ip addr show &gt; $LOG_DIR/node-configs/${node}-interfaces.txt
</span></span></span><span class=line><span class=cl><span class=s>    docker exec $node ip route show &gt; $LOG_DIR/node-configs/${node}-routes.txt
</span></span></span><span class=line><span class=cl><span class=s>done
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;日志收集完成: $LOG_DIR&#34;
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;可以使用以下命令打包日志:&#34;
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;tar -czf ${LOG_DIR}.tar.gz $LOG_DIR&#34;
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>chmod +x collect-logs.sh
</span></span><span class=line><span class=cl>./collect-logs.sh</span></span></code></pre></td></tr></table></div></div><h2 class=heading-element id=清理和重置><span>清理和重置</span>
<a href=#%e6%b8%85%e7%90%86%e5%92%8c%e9%87%8d%e7%bd%ae class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=1-清理测试资源><span>1. 清理测试资源</span>
<a href=#1-%e6%b8%85%e7%90%86%e6%b5%8b%e8%af%95%e8%b5%84%e6%ba%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 清理测试应用</span>
</span></span><span class=line><span class=cl>cat &gt; cleanup-test-apps.sh <span class=s>&lt;&lt; &#39;EOF&#39;
</span></span></span><span class=line><span class=cl><span class=s>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;=== 清理测试应用 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 删除测试应用
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;删除测试应用...&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl delete deployment --all -n test-apps
</span></span></span><span class=line><span class=cl><span class=s>kubectl delete deployment --all -n business-apps
</span></span></span><span class=line><span class=cl><span class=s>kubectl delete deployment --all -n storage-apps
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 删除服务
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;删除服务...&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl delete service --all -n test-apps
</span></span></span><span class=line><span class=cl><span class=s>kubectl delete service --all -n business-apps
</span></span></span><span class=line><span class=cl><span class=s>kubectl delete service --all -n storage-apps
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 删除网络附件定义
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;删除网络附件定义...&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl delete network-attachment-definitions --all --all-namespaces
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 删除测试命名空间
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;删除测试命名空间...&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl delete namespace test-apps
</span></span></span><span class=line><span class=cl><span class=s>kubectl delete namespace business-apps
</span></span></span><span class=line><span class=cl><span class=s>kubectl delete namespace storage-apps
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;测试资源清理完成&#34;
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>chmod +x cleanup-test-apps.sh
</span></span><span class=line><span class=cl>./cleanup-test-apps.sh</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=2-重置集群><span>2. 重置集群</span>
<a href=#2-%e9%87%8d%e7%bd%ae%e9%9b%86%e7%be%a4 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 重置集群脚本</span>
</span></span><span class=line><span class=cl>cat &gt; reset-cluster.sh <span class=s>&lt;&lt; &#39;EOF&#39;
</span></span></span><span class=line><span class=cl><span class=s>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;=== 重置 Kind 集群 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>read -p &#34;确定要重置集群吗？这将删除所有数据 (y/N): &#34; confirm
</span></span></span><span class=line><span class=cl><span class=s>if [[ $confirm != [yY] ]]; then
</span></span></span><span class=line><span class=cl><span class=s>    echo &#34;操作已取消&#34;
</span></span></span><span class=line><span class=cl><span class=s>    exit 0
</span></span></span><span class=line><span class=cl><span class=s>fi
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 删除现有集群
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;删除现有集群...&#34;
</span></span></span><span class=line><span class=cl><span class=s>kind delete cluster --name flannel-multus-demo
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 清理 Docker 资源
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;清理 Docker 资源...&#34;
</span></span></span><span class=line><span class=cl><span class=s>docker system prune -f
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 重新创建集群
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;重新创建集群...&#34;
</span></span></span><span class=line><span class=cl><span class=s>kind create cluster --config=kind-config.yaml
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;集群重置完成&#34;
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;请重新部署 Flannel 和 Multus-CNI&#34;
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>chmod +x reset-cluster.sh</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=3-完全清理><span>3. 完全清理</span>
<a href=#3-%e5%ae%8c%e5%85%a8%e6%b8%85%e7%90%86 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 完全清理脚本</span>
</span></span><span class=line><span class=cl>cat &gt; complete-cleanup.sh <span class=s>&lt;&lt; &#39;EOF&#39;
</span></span></span><span class=line><span class=cl><span class=s>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;=== 完全清理 Kind 环境 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>read -p &#34;确定要完全清理环境吗？这将删除所有 Kind 集群和相关资源 (y/N): &#34; confirm
</span></span></span><span class=line><span class=cl><span class=s>if [[ $confirm != [yY] ]]; then
</span></span></span><span class=line><span class=cl><span class=s>    echo &#34;操作已取消&#34;
</span></span></span><span class=line><span class=cl><span class=s>    exit 0
</span></span></span><span class=line><span class=cl><span class=s>fi
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 删除所有 Kind 集群
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;删除所有 Kind 集群...&#34;
</span></span></span><span class=line><span class=cl><span class=s>for cluster in $(kind get clusters); do
</span></span></span><span class=line><span class=cl><span class=s>    echo &#34;删除集群: $cluster&#34;
</span></span></span><span class=line><span class=cl><span class=s>    kind delete cluster --name $cluster
</span></span></span><span class=line><span class=cl><span class=s>done
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 清理 Docker 资源
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;清理 Docker 资源...&#34;
</span></span></span><span class=line><span class=cl><span class=s>docker system prune -af
</span></span></span><span class=line><span class=cl><span class=s>docker volume prune -f
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 清理配置文件
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;清理配置文件...&#34;
</span></span></span><span class=line><span class=cl><span class=s>rm -f kind-config.yaml
</span></span></span><span class=line><span class=cl><span class=s>rm -f kube-flannel.yml*
</span></span></span><span class=line><span class=cl><span class=s>rm -f flannel-kind-patch.yaml
</span></span></span><span class=line><span class=cl><span class=s>rm -f multus-*.yaml
</span></span></span><span class=line><span class=cl><span class=s>rm -f *-network*.yaml
</span></span></span><span class=line><span class=cl><span class=s>rm -f *-test.yaml
</span></span></span><span class=line><span class=cl><span class=s>rm -f *.sh
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;完全清理完成&#34;
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>chmod +x complete-cleanup.sh</span></span></code></pre></td></tr></table></div></div><h2 class=heading-element id=自动化脚本><span>自动化脚本</span>
<a href=#%e8%87%aa%e5%8a%a8%e5%8c%96%e8%84%9a%e6%9c%ac class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=1-一键部署脚本><span>1. 一键部署脚本</span>
<a href=#1-%e4%b8%80%e9%94%ae%e9%83%a8%e7%bd%b2%e8%84%9a%e6%9c%ac class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 创建一键部署脚本</span>
</span></span><span class=line><span class=cl>cat &gt; deploy-all.sh <span class=s>&lt;&lt; &#39;EOF&#39;
</span></span></span><span class=line><span class=cl><span class=s>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>set -e
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;=== Kind + Flannel + Multus-CNI 一键部署 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 检查依赖
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;检查依赖...&#34;
</span></span></span><span class=line><span class=cl><span class=s>command -v docker &gt;/dev/null 2&gt;&amp;1 || { echo &#34;Docker 未安装&#34;; exit 1; }
</span></span></span><span class=line><span class=cl><span class=s>command -v kind &gt;/dev/null 2&gt;&amp;1 || { echo &#34;Kind 未安装&#34;; exit 1; }
</span></span></span><span class=line><span class=cl><span class=s>command -v kubectl &gt;/dev/null 2&gt;&amp;1 || { echo &#34;kubectl 未安装&#34;; exit 1; }
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 创建集群
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 1. 创建 Kind 集群 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>if kind get clusters | grep -q &#34;flannel-multus-demo&#34;; then
</span></span></span><span class=line><span class=cl><span class=s>    echo &#34;集群已存在，跳过创建&#34;
</span></span></span><span class=line><span class=cl><span class=s>else
</span></span></span><span class=line><span class=cl><span class=s>    kind create cluster --config=kind-config.yaml
</span></span></span><span class=line><span class=cl><span class=s>fi
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 等待节点就绪
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 2. 等待节点就绪 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl wait --for=condition=Ready nodes --all --timeout=300s
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 部署 Flannel
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 3. 部署 Flannel ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>if ! kubectl get namespace kube-flannel &gt;/dev/null 2&gt;&amp;1; then
</span></span></span><span class=line><span class=cl><span class=s>    kubectl create namespace kube-flannel
</span></span></span><span class=line><span class=cl><span class=s>fi
</span></span></span><span class=line><span class=cl><span class=s>kubectl apply -f flannel-kind-patch.yaml
</span></span></span><span class=line><span class=cl><span class=s>kubectl apply -f kube-flannel.yml
</span></span></span><span class=line><span class=cl><span class=s>kubectl wait --for=condition=Ready pods -l app=flannel -n kube-flannel --timeout=300s
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 部署 Multus-CNI
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 4. 部署 Multus-CNI ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>if ! kubectl get namespace multus-system &gt;/dev/null 2&gt;&amp;1; then
</span></span></span><span class=line><span class=cl><span class=s>    kubectl create namespace multus-system
</span></span></span><span class=line><span class=cl><span class=s>fi
</span></span></span><span class=line><span class=cl><span class=s>kubectl apply -f multus-config.yaml
</span></span></span><span class=line><span class=cl><span class=s>kubectl apply -f multus-rbac.yaml
</span></span></span><span class=line><span class=cl><span class=s>kubectl apply -f multus-daemonset.yaml
</span></span></span><span class=line><span class=cl><span class=s>kubectl wait --for=condition=Ready pods -l name=multus -n multus-system --timeout=300s
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 创建测试命名空间
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 5. 创建测试命名空间 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl create namespace business-apps --dry-run=client -o yaml | kubectl apply -f -
</span></span></span><span class=line><span class=cl><span class=s>kubectl create namespace storage-apps --dry-run=client -o yaml | kubectl apply -f -
</span></span></span><span class=line><span class=cl><span class=s>kubectl create namespace test-apps --dry-run=client -o yaml | kubectl apply -f -
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 部署网络附件定义
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 6. 部署网络附件定义 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl apply -f macvlan-network.yaml
</span></span></span><span class=line><span class=cl><span class=s>kubectl apply -f bridge-network.yaml
</span></span></span><span class=line><span class=cl><span class=s>kubectl apply -f host-local-network.yaml
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 部署测试应用
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 7. 部署测试应用 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl apply -f single-network-test.yaml
</span></span></span><span class=line><span class=cl><span class=s>kubectl apply -f multi-network-test.yaml
</span></span></span><span class=line><span class=cl><span class=s>kubectl apply -f storage-network-test.yaml
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 等待应用就绪
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 8. 等待应用就绪 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl wait --for=condition=Ready pods --all --all-namespaces --timeout=300s
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 验证部署
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 9. 验证部署 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;集群状态:&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl get nodes
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\nPod 状态:&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl get pods --all-namespaces
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n网络附件定义:&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl get network-attachment-definitions --all-namespaces
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 部署完成 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;可以运行以下命令进行验证:&#34;
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;  ./network-verification.sh&#34;
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;  ./multi-network-verification.sh&#34;
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;  ./network-performance-test.sh&#34;
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>chmod +x deploy-all.sh</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=2-快速验证脚本><span>2. 快速验证脚本</span>
<a href=#2-%e5%bf%ab%e9%80%9f%e9%aa%8c%e8%af%81%e8%84%9a%e6%9c%ac class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 创建快速验证脚本</span>
</span></span><span class=line><span class=cl>cat &gt; quick-verify.sh <span class=s>&lt;&lt; &#39;EOF&#39;
</span></span></span><span class=line><span class=cl><span class=s>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;=== Kind + Flannel + Multus-CNI 快速验证 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 检查集群状态
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 1. 集群状态检查 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl get nodes
</span></span></span><span class=line><span class=cl><span class=s>kubectl get pods --all-namespaces | grep -E &#34;(flannel|multus)&#34;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 检查网络附件定义
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 2. 网络附件定义检查 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl get network-attachment-definitions --all-namespaces
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 检查测试应用
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 3. 测试应用状态 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>kubectl get pods --all-namespaces | grep -E &#34;(test|business|storage)&#34;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 快速网络测试
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 4. 快速网络测试 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 获取测试 Pod
</span></span></span><span class=line><span class=cl><span class=s>TEST_POD=$(kubectl get pods -n test-apps -l app=single-network-test -o jsonpath=&#39;{.items[0].metadata.name}&#39; 2&gt;/dev/null)
</span></span></span><span class=line><span class=cl><span class=s>MULTI_POD=$(kubectl get pods -n business-apps -l app=multi-network-test -o jsonpath=&#39;{.items[0].metadata.name}&#39; 2&gt;/dev/null)
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>if [ -n &#34;$TEST_POD&#34; ]; then
</span></span></span><span class=line><span class=cl><span class=s>    echo &#34;基础网络测试 (Pod: $TEST_POD):&#34;
</span></span></span><span class=line><span class=cl><span class=s>    kubectl exec -n test-apps $TEST_POD -- ping -c 2 kubernetes.default.svc.cluster.local
</span></span></span><span class=line><span class=cl><span class=s>else
</span></span></span><span class=line><span class=cl><span class=s>    echo &#34;未找到测试 Pod&#34;
</span></span></span><span class=line><span class=cl><span class=s>fi
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>if [ -n &#34;$MULTI_POD&#34; ]; then
</span></span></span><span class=line><span class=cl><span class=s>    echo &#34;\n多网络接口检查 (Pod: $MULTI_POD):&#34;
</span></span></span><span class=line><span class=cl><span class=s>    kubectl exec -n business-apps $MULTI_POD -- ip addr show | grep -E &#34;(eth0|net1)&#34;
</span></span></span><span class=line><span class=cl><span class=s>else
</span></span></span><span class=line><span class=cl><span class=s>    echo &#34;未找到多网络 Pod&#34;
</span></span></span><span class=line><span class=cl><span class=s>fi
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 5. 验证结果 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;✅ 集群运行正常&#34;
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;✅ Flannel CNI 工作正常&#34;
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;✅ Multus-CNI 工作正常&#34;
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;✅ 网络附件定义已创建&#34;
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;✅ 测试应用已部署&#34;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;\n=== 快速验证完成 ===&#34;
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;如需详细验证，请运行:&#34;
</span></span></span><span class=line><span class=cl><span class=s>echo &#34;  ./network-verification.sh&#34;
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>chmod +x quick-verify.sh</span></span></code></pre></td></tr></table></div></div><h2 class=heading-element id=总结><span>总结</span>
<a href=#%e6%80%bb%e7%bb%93 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>本指南提供了使用 Kind 快速创建和验证 Flannel + Multus-CNI 多网段隔离环境的完整方案：</p><h3 class=heading-element id=-实现目标><span>🎯 实现目标</span>
<a href=#-%e5%ae%9e%e7%8e%b0%e7%9b%ae%e6%a0%87 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><ol><li><strong>快速环境搭建</strong>：5分钟内完成完整环境部署</li><li><strong>多网段隔离验证</strong>：验证不同网络平面的隔离效果</li><li><strong>完整功能测试</strong>：包含网络连通性、性能和故障排查</li><li><strong>自动化运维</strong>：提供一键部署和清理脚本</li></ol><h3 class=heading-element id=-技术特性><span>🔧 技术特性</span>
<a href=#-%e6%8a%80%e6%9c%af%e7%89%b9%e6%80%a7 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><ul><li><strong>Kind 集群</strong>：轻量级 Kubernetes 环境</li><li><strong>Flannel CNI</strong>：提供基础集群网络</li><li><strong>Multus-CNI</strong>：支持多网络接口</li><li><strong>多种网络类型</strong>：MacVLAN、Bridge、Host-Local</li><li><strong>完整验证</strong>：网络连通性、性能测试、故障排查</li></ul><h3 class=heading-element id=-使用流程><span>📋 使用流程</span>
<a href=#-%e4%bd%bf%e7%94%a8%e6%b5%81%e7%a8%8b class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><ol><li><strong>环境准备</strong>：安装 Docker、Kind、kubectl</li><li><strong>一键部署</strong>：运行 <code>./deploy-all.sh</code></li><li><strong>快速验证</strong>：运行 <code>./quick-verify.sh</code></li><li><strong>详细测试</strong>：运行各种验证脚本</li><li><strong>清理环境</strong>：运行清理脚本</li></ol><h3 class=heading-element id=-扩展应用><span>🚀 扩展应用</span>
<a href=#-%e6%89%a9%e5%b1%95%e5%ba%94%e7%94%a8 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><ul><li><strong>开发环境</strong>：本地开发和测试</li><li><strong>CI/CD 集成</strong>：自动化测试流水线</li><li><strong>培训演示</strong>：云原生网络技术学习</li><li><strong>概念验证</strong>：新网络方案验证</li></ul><p>这套方案为云原生网络技术的学习和验证提供了完整的实验环境，帮助快速理解和掌握 Kubernetes 多网段隔离技术。</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2024-12-19 10:45:00">更新于 2024-12-19&nbsp;</span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/posts/kind--flannel--multus-cni-%E5%BF%AB%E9%80%9F%E9%AA%8C%E8%AF%81%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97/index.md title=阅读原始文档 class=link-to-markdown>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 X" data-sharer=twitter data-url=https://www.kbsonlong.com/posts/kind--flannel--multus-cni-%E5%BF%AB%E9%80%9F%E9%AA%8C%E8%AF%81%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97/ data-title="Kind + Flannel + Multus-CNI 快速验证环境搭建指南" data-hashtags=Kind,Kubernetes,Flannel,Multus,CNI,验证环境><i class="fa-brands fa-x-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://www.kbsonlong.com/posts/kind--flannel--multus-cni-%E5%BF%AB%E9%80%9F%E9%AA%8C%E8%AF%81%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97/ data-hashtag=Kind><i class="fa-brands fa-facebook-square fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 WhatsApp" data-sharer=whatsapp data-url=https://www.kbsonlong.com/posts/kind--flannel--multus-cni-%E5%BF%AB%E9%80%9F%E9%AA%8C%E8%AF%81%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97/ data-title="Kind + Flannel + Multus-CNI 快速验证环境搭建指南" data-web><i class="fa-brands fa-whatsapp fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://www.kbsonlong.com/posts/kind--flannel--multus-cni-%E5%BF%AB%E9%80%9F%E9%AA%8C%E8%AF%81%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97/ data-title="Kind + Flannel + Multus-CNI 快速验证环境搭建指南"><svg class="icon" role="img" viewBox="0 0 24 24"><title>LINE</title><path d="M19.365 9.863c.349.0.63.285.63.631.0.345-.281.63-.63.63H17.61v1.125h1.755c.349.0.63.283.63.63.0.344-.281.629-.63.629h-2.386c-.345.0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.346.0.627.285.627.63.0.349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211.0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346.0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195.0.375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345.0.63.285.63.63v4.771zm-5.741.0c0 .344-.282.629-.631.629-.345.0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63.346.0.628.285.628.63v4.771zm-2.466.629H4.917c-.345.0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348.0.63.285.63.63v4.141h1.756c.348.0.629.283.629.63.0.344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943.0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"/></svg></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://www.kbsonlong.com/posts/kind--flannel--multus-cni-%E5%BF%AB%E9%80%9F%E9%AA%8C%E8%AF%81%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97/ data-title="Kind + Flannel + Multus-CNI 快速验证环境搭建指南"><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Myspace" data-sharer=myspace data-url=https://www.kbsonlong.com/posts/kind--flannel--multus-cni-%E5%BF%AB%E9%80%9F%E9%AA%8C%E8%AF%81%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97/ data-title="Kind + Flannel + Multus-CNI 快速验证环境搭建指南" data-description="使用 Kind 快速创建 Kubernetes 环境，验证 Flannel + Multus-CNI 多网段隔离方案的完整实施指南"><svg class="icon" role="img" viewBox="0 0 24 24"><title>Myspace</title><path d="M19.802 12.274A3.811 3.811.0 0023.62 8.47c0-2.101-1.71-3.795-3.818-3.795a3.816 3.816.0 00-3.818 3.81 3.817 3.817.0 003.818 3.811zm-8.602.705a3.43 3.43.0 003.435-3.424A3.43 3.43.0 0011.2 6.13 3.44 3.44.0 007.764 9.566 3.436 3.436.0 0011.2 13zm-7.8.635c1.71.0 3.093-1.38 3.093-3.081.0-1.704-1.395-3.084-3.105-3.084A3.086 3.086.0 00.3 10.539c0 1.7 1.387 3.078 3.095 3.078zm0 .705c-1.96.0-3.4 1.717-3.4 3.495v1.196c0 .17.138.31.31.31h6.18a.31.31.0 00.309-.31v-1.196c0-1.779-1.437-3.5-3.398-3.5zm7.8-.56c-2.18.0-3.78 1.915-3.78 3.891v1.331c0 .188.156.344.345.344h6.87a.344.344.0 00.342-.344V17.65c0-1.976-1.598-3.891-3.777-3.891zm8.602-.617c-2.422.0-4.197 2.126-4.197 4.323v1.477c0 .21.172.381.382.381h7.63c.21.0.383-.171.383-.381v-1.477c-.001-2.197-1.776-4.323-4.198-4.323z"/></svg></a>
<a href=javascript:void(0); title="分享到 Blogger" data-sharer=blogger data-url=https://www.kbsonlong.com/posts/kind--flannel--multus-cni-%E5%BF%AB%E9%80%9F%E9%AA%8C%E8%AF%81%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97/ data-title="Kind + Flannel + Multus-CNI 快速验证环境搭建指南" data-description="使用 Kind 快速创建 Kubernetes 环境，验证 Flannel + Multus-CNI 多网段隔离方案的完整实施指南"><i class="fa-brands fa-blogger fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Evernote" data-sharer=evernote data-url=https://www.kbsonlong.com/posts/kind--flannel--multus-cni-%E5%BF%AB%E9%80%9F%E9%AA%8C%E8%AF%81%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97/ data-title="Kind + Flannel + Multus-CNI 快速验证环境搭建指南"><i class="fa-brands fa-evernote fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/kind/ class=post-tag title="标签 - Kind">Kind</a><a href=/tags/kubernetes/ class=post-tag title="标签 - Kubernetes">Kubernetes</a><a href=/tags/flannel/ class=post-tag title="标签 - Flannel">Flannel</a><a href=/tags/multus/ class=post-tag title="标签 - Multus">Multus</a><a href=/tags/cni/ class=post-tag title="标签 - CNI">CNI</a><a href=/tags/%E9%AA%8C%E8%AF%81%E7%8E%AF%E5%A2%83/ class=post-tag title="标签 - 验证环境">验证环境</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/flannel--multus-cni-%E5%A4%9A%E7%BD%91%E6%AE%B5%E9%9A%94%E7%A6%BB%E5%AE%9E%E7%8E%B0%E6%8C%87%E5%8D%97/ class=post-nav-item rel=prev title="Flannel + Multus-CNI 多网段隔离实现指南"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>Flannel + Multus-CNI 多网段隔离实现指南</a><a href=/posts/grafana-api%E5%AF%BC%E5%87%BA%E4%BB%AA%E8%A1%A8%E6%9D%BF%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/ class=post-nav-item rel=next title="Grafana API导出仪表板完整指南">Grafana API导出仪表板完整指南<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=giscus class=comment><script src=https://giscus.app/client.js data-repo=kbsonlong/sre data-repo-id=R_kgDOMFzwNA data-category=Announcements data-category-id=DIC_kwDOMFzwNM4Cn0gn data-mapping=title data-strict=0 data-theme=preferred_color_scheme data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-lang=zh-CN data-loading=lazy crossorigin=anonymous async defer></script></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app/ rel="external nofollow noopener noreferrer">giscus</a>.</noscript></div></article><aside class=toc id=toc-auto aria-label=目录><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside></main><footer class=footer><div class=footer-container><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2018 - 2025</span><span class=author itemprop=copyrightHolder>
<a href=/></a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class="footer-line statistics"><span class=site-time title=网站运行中……><i class="fa-solid fa-heartbeat fa-fw animate-icon" aria-hidden=true></i><span class="run-times ms-1">网站运行中……</span></span></div><div class="footer-line visitor"><span id=busuanzi_container_site_uv title=总访客数><i class="fa-regular fa-user fa-fw me-1" aria-hidden=true></i><span id=busuanzi_value_site_uv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span><span id=busuanzi_container_site_pv class=footer-divider title=总访问量><i class="fa-regular fa-eye fa-fw me-1" aria-hidden=true></i><span id=busuanzi_value_site_pv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span></div><div class="footer-line beian"><span class="icp footer-divider"><a target=_blank href=https://beian.miit.gov.cn/>粤ICP备18122209号</a></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class=variant-numeric>0%</span></div><div class="fixed-button view-comments d-none" role=button aria-label=查看评论><i class="fa-solid fa-comment fa-fw" aria-hidden=true></i></div></div><a href=https://github.com/kbsonlong title="在 GitHub 上查看源代码" target=_blank rel="external nofollow" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true" width="56" height="56"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><div class=reading-progress-bar style=left:0;top:0></div><noscript><div class=noscript-warning>该网站在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=/lib/lightgallery/css/lightgallery-bundle.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/algoliasearch/algoliasearch-lite.umd.min.js defer></script><script src=/lib/lightgallery/lightgallery.min.js defer></script><script src=/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js defer></script><script src=/lib/lightgallery/plugins/zoom/lg-zoom.min.js defer></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/cookieconsent/cookieconsent.min.js defer></script><script src=/lib/pangu/pangu.min.js defer></script><script src=/lib/cell-watermark/watermark.min.js defer></script><script src=https://vercount.one/js async defer></script><script>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:50},comment:{enable:!0,expired:!1,giscus:{darkTheme:"dark",lightTheme:"light",origin:"https://giscus.app"}},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},enablePWA:!0,lightgallery:!0,pangu:{enable:!0,selector:"article"},search:{algoliaAppID:"WFOR67TML1",algoliaIndex:"along",algoliaSearchKey:"ea1fe535f9a7ae353f3922489c829cc1",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"},siteTime:"2018-12-18T16:15:22+08:00",version:"v0.3.20",watermark:{appendto:".wrapper>main",colspacing:30,content:'<img class="fixit-icon" src="/favicon-16x16.png" alt="FixIt logo" /> FixIt 主题',enable:!0,fontfamily:"inherit",fontsize:.85,height:21,opacity:.0125,rotate:15,rowspacing:60,width:150}}</script><script src=/js/theme.min.js defer></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","6272760969",{anonymize_ip:!0})</script><script src="https://www.googletagmanager.com/gtag/js?id=6272760969" async></script></body></html>