<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>Grafana Sqlite3 Migrations to PostgreSQL - 蜷缩的蜗牛</title><meta name=author content>
<meta name=description content="准备环境 pgloader PostgreSQL Grafana 初始化数据库 启动 PostgreSQL 和 Grafana 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 version: '3.8' services: postgres: image: postgres:15 network_mode: host environment: POSTGRES_DB: grafana POSTGRES_USER: grafana POSTGRES_PASSWORD: grafana volumes: - postgres_data:/var/lib/postgresql/data - ./postgresql.conf:/etc/postgresql/postgresql.conf command: postgres -c config_file=/etc/postgresql/postgresql.conf grafana: image: grafana/grafana:12.0.2 container_name: grafana network_mode: host environment: - GF_DATABASE_TYPE=postgres - GF_DATABASE_HOST=localhost:5432 - GF_DATABASE_NAME=grafana - GF_DATABASE_USER=grafana - GF_DATABASE_PASSWORD=grafana - GF_DATABASE_SSL_MODE=disable depends_on: - postgres volumes: postgres_data: driver: local 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 # PostgreSQL 配置文件 - 针对 Grafana 高可用部署优化 # 连接设置 listen_addresses = '*' port = 5432 max_connections = 200 superuser_reserved_connections = 3 # 内存设置 shared_buffers = 256MB effective_cache_size = 1GB maintenance_work_mem = 64MB work_mem = 4MB # WAL 设置（用于复制） wal_level = replica max_wal_senders = 3 max_replication_slots = 3 wal_keep_size = 1GB archive_mode = on archive_command = 'cp %p /var/lib/postgresql/archive/%f' # 检查点设置 checkpoint_completion_target = 0.9 checkpoint_timeout = 15min max_wal_size = 2GB min_wal_size = 80MB # 日志设置 logging_collector = on log_directory = 'log' log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log' log_rotation_age = 1d log_rotation_size = 100MB log_min_duration_statement = 1000 log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h ' log_statement = 'ddl' log_temp_files = 0 # 性能优化 random_page_cost = 1.1 effective_io_concurrency = 200 default_statistics_target = 100 # 安全设置 ssl = off # 复制设置 hot_standby = on hot_standby_feedback = on max_standby_streaming_delay = 30s wal_receiver_timeout = 60s # 自动清理 autovacuum = on autovacuum_max_workers = 3 autovacuum_naptime = 1min autovacuum_vacuum_threshold = 50 autovacuum_analyze_threshold = 50 # 时区设置 timezone = 'UTC' log_timezone = 'UTC' # 区域设置 lc_messages = 'en_US.UTF-8' lc_monetary = 'en_US.UTF-8' lc_numeric = 'en_US.UTF-8' lc_time = 'en_US.UTF-8' default_text_search_config = 'pg_catalog.english' 导出 grafana 表结构 1 2 docker compose up -d docker exec -ti postgres pg_dump --schema-only -U grafana grafana > grafana-schema.sql 清理 postgres 数据库 停止 postgres 和 grafana,并删除 postgres 数据库
"><meta name=keywords content='pgloader,PostgreSQL,SQLite,数据迁移'><meta itemprop=name content="Grafana sqlite3 migrations to PostgreSQL"><meta itemprop=description content="准备环境 pgloader PostgreSQL Grafana 初始化数据库 启动 PostgreSQL 和 Grafana 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 version: '3.8' services: postgres: image: postgres:15 network_mode: host environment: POSTGRES_DB: grafana POSTGRES_USER: grafana POSTGRES_PASSWORD: grafana volumes: - postgres_data:/var/lib/postgresql/data - ./postgresql.conf:/etc/postgresql/postgresql.conf command: postgres -c config_file=/etc/postgresql/postgresql.conf grafana: image: grafana/grafana:12.0.2 container_name: grafana network_mode: host environment: - GF_DATABASE_TYPE=postgres - GF_DATABASE_HOST=localhost:5432 - GF_DATABASE_NAME=grafana - GF_DATABASE_USER=grafana - GF_DATABASE_PASSWORD=grafana - GF_DATABASE_SSL_MODE=disable depends_on: - postgres volumes: postgres_data: driver: local 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 # PostgreSQL 配置文件 - 针对 Grafana 高可用部署优化 # 连接设置 listen_addresses = '*' port = 5432 max_connections = 200 superuser_reserved_connections = 3 # 内存设置 shared_buffers = 256MB effective_cache_size = 1GB maintenance_work_mem = 64MB work_mem = 4MB # WAL 设置（用于复制） wal_level = replica max_wal_senders = 3 max_replication_slots = 3 wal_keep_size = 1GB archive_mode = on archive_command = 'cp %p /var/lib/postgresql/archive/%f' # 检查点设置 checkpoint_completion_target = 0.9 checkpoint_timeout = 15min max_wal_size = 2GB min_wal_size = 80MB # 日志设置 logging_collector = on log_directory = 'log' log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log' log_rotation_age = 1d log_rotation_size = 100MB log_min_duration_statement = 1000 log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h ' log_statement = 'ddl' log_temp_files = 0 # 性能优化 random_page_cost = 1.1 effective_io_concurrency = 200 default_statistics_target = 100 # 安全设置 ssl = off # 复制设置 hot_standby = on hot_standby_feedback = on max_standby_streaming_delay = 30s wal_receiver_timeout = 60s # 自动清理 autovacuum = on autovacuum_max_workers = 3 autovacuum_naptime = 1min autovacuum_vacuum_threshold = 50 autovacuum_analyze_threshold = 50 # 时区设置 timezone = 'UTC' log_timezone = 'UTC' # 区域设置 lc_messages = 'en_US.UTF-8' lc_monetary = 'en_US.UTF-8' lc_numeric = 'en_US.UTF-8' lc_time = 'en_US.UTF-8' default_text_search_config = 'pg_catalog.english' 导出 grafana 表结构 1 2 docker compose up -d docker exec -ti postgres pg_dump --schema-only -U grafana grafana > grafana-schema.sql 清理 postgres 数据库 停止 postgres 和 grafana,并删除 postgres 数据库"><meta itemprop=datePublished content="2025-07-23T10:30:00+08:00"><meta itemprop=dateModified content="2025-07-23T20:30:00+08:00"><meta itemprop=wordCount content="1453"><meta itemprop=image content="https://www.kbsonlong.com/logo_transparent.png"><meta itemprop=keywords content="Pgloader,PostgreSQL,SQLite,数据迁移"><meta property="og:url" content="https://www.kbsonlong.com/posts/grafana-sqlite3-migrations-to-postgresql/"><meta property="og:site_name" content="蜷缩的蜗牛"><meta property="og:title" content="Grafana sqlite3 migrations to PostgreSQL"><meta property="og:description" content="准备环境 pgloader PostgreSQL Grafana 初始化数据库 启动 PostgreSQL 和 Grafana 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 version: '3.8' services: postgres: image: postgres:15 network_mode: host environment: POSTGRES_DB: grafana POSTGRES_USER: grafana POSTGRES_PASSWORD: grafana volumes: - postgres_data:/var/lib/postgresql/data - ./postgresql.conf:/etc/postgresql/postgresql.conf command: postgres -c config_file=/etc/postgresql/postgresql.conf grafana: image: grafana/grafana:12.0.2 container_name: grafana network_mode: host environment: - GF_DATABASE_TYPE=postgres - GF_DATABASE_HOST=localhost:5432 - GF_DATABASE_NAME=grafana - GF_DATABASE_USER=grafana - GF_DATABASE_PASSWORD=grafana - GF_DATABASE_SSL_MODE=disable depends_on: - postgres volumes: postgres_data: driver: local 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 # PostgreSQL 配置文件 - 针对 Grafana 高可用部署优化 # 连接设置 listen_addresses = '*' port = 5432 max_connections = 200 superuser_reserved_connections = 3 # 内存设置 shared_buffers = 256MB effective_cache_size = 1GB maintenance_work_mem = 64MB work_mem = 4MB # WAL 设置（用于复制） wal_level = replica max_wal_senders = 3 max_replication_slots = 3 wal_keep_size = 1GB archive_mode = on archive_command = 'cp %p /var/lib/postgresql/archive/%f' # 检查点设置 checkpoint_completion_target = 0.9 checkpoint_timeout = 15min max_wal_size = 2GB min_wal_size = 80MB # 日志设置 logging_collector = on log_directory = 'log' log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log' log_rotation_age = 1d log_rotation_size = 100MB log_min_duration_statement = 1000 log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h ' log_statement = 'ddl' log_temp_files = 0 # 性能优化 random_page_cost = 1.1 effective_io_concurrency = 200 default_statistics_target = 100 # 安全设置 ssl = off # 复制设置 hot_standby = on hot_standby_feedback = on max_standby_streaming_delay = 30s wal_receiver_timeout = 60s # 自动清理 autovacuum = on autovacuum_max_workers = 3 autovacuum_naptime = 1min autovacuum_vacuum_threshold = 50 autovacuum_analyze_threshold = 50 # 时区设置 timezone = 'UTC' log_timezone = 'UTC' # 区域设置 lc_messages = 'en_US.UTF-8' lc_monetary = 'en_US.UTF-8' lc_numeric = 'en_US.UTF-8' lc_time = 'en_US.UTF-8' default_text_search_config = 'pg_catalog.english' 导出 grafana 表结构 1 2 docker compose up -d docker exec -ti postgres pg_dump --schema-only -U grafana grafana > grafana-schema.sql 清理 postgres 数据库 停止 postgres 和 grafana,并删除 postgres 数据库"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-07-23T10:30:00+08:00"><meta property="article:modified_time" content="2025-07-23T20:30:00+08:00"><meta property="article:tag" content="Pgloader"><meta property="article:tag" content="PostgreSQL"><meta property="article:tag" content="SQLite"><meta property="article:tag" content="数据迁移"><meta property="og:image" content="https://www.kbsonlong.com/logo_transparent.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.kbsonlong.com/logo_transparent.png"><meta name=twitter:title content="Grafana sqlite3 migrations to PostgreSQL"><meta name=twitter:description content="准备环境 pgloader PostgreSQL Grafana 初始化数据库 启动 PostgreSQL 和 Grafana 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 version: '3.8' services: postgres: image: postgres:15 network_mode: host environment: POSTGRES_DB: grafana POSTGRES_USER: grafana POSTGRES_PASSWORD: grafana volumes: - postgres_data:/var/lib/postgresql/data - ./postgresql.conf:/etc/postgresql/postgresql.conf command: postgres -c config_file=/etc/postgresql/postgresql.conf grafana: image: grafana/grafana:12.0.2 container_name: grafana network_mode: host environment: - GF_DATABASE_TYPE=postgres - GF_DATABASE_HOST=localhost:5432 - GF_DATABASE_NAME=grafana - GF_DATABASE_USER=grafana - GF_DATABASE_PASSWORD=grafana - GF_DATABASE_SSL_MODE=disable depends_on: - postgres volumes: postgres_data: driver: local 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 # PostgreSQL 配置文件 - 针对 Grafana 高可用部署优化 # 连接设置 listen_addresses = '*' port = 5432 max_connections = 200 superuser_reserved_connections = 3 # 内存设置 shared_buffers = 256MB effective_cache_size = 1GB maintenance_work_mem = 64MB work_mem = 4MB # WAL 设置（用于复制） wal_level = replica max_wal_senders = 3 max_replication_slots = 3 wal_keep_size = 1GB archive_mode = on archive_command = 'cp %p /var/lib/postgresql/archive/%f' # 检查点设置 checkpoint_completion_target = 0.9 checkpoint_timeout = 15min max_wal_size = 2GB min_wal_size = 80MB # 日志设置 logging_collector = on log_directory = 'log' log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log' log_rotation_age = 1d log_rotation_size = 100MB log_min_duration_statement = 1000 log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h ' log_statement = 'ddl' log_temp_files = 0 # 性能优化 random_page_cost = 1.1 effective_io_concurrency = 200 default_statistics_target = 100 # 安全设置 ssl = off # 复制设置 hot_standby = on hot_standby_feedback = on max_standby_streaming_delay = 30s wal_receiver_timeout = 60s # 自动清理 autovacuum = on autovacuum_max_workers = 3 autovacuum_naptime = 1min autovacuum_vacuum_threshold = 50 autovacuum_analyze_threshold = 50 # 时区设置 timezone = 'UTC' log_timezone = 'UTC' # 区域设置 lc_messages = 'en_US.UTF-8' lc_monetary = 'en_US.UTF-8' lc_numeric = 'en_US.UTF-8' lc_time = 'en_US.UTF-8' default_text_search_config = 'pg_catalog.english' 导出 grafana 表结构 1 2 docker compose up -d docker exec -ti postgres pg_dump --schema-only -U grafana grafana > grafana-schema.sql 清理 postgres 数据库 停止 postgres 和 grafana,并删除 postgres 数据库"><meta name=application-name content="FixIt"><meta name=apple-mobile-web-app-title content="FixIt"><meta name=theme-color data-light=#ffffff data-dark=#252627 content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical type=text/html href=https://www.kbsonlong.com/posts/grafana-sqlite3-migrations-to-postgresql/ title="Grafana sqlite3 migrations to PostgreSQL - 蜷缩的蜗牛"><link rel=prev type=text/html href=https://www.kbsonlong.com/posts/karmada-resourceinterpretercustomization/ title=Karmada声明式配置详细指引><link rel=next type=text/html href=https://www.kbsonlong.com/posts/kubernetes-etcd-%E9%9B%86%E7%BE%A4%E6%8C%89%E8%B5%84%E6%BA%90%E6%8B%86%E5%88%86%E4%B8%8E-tls-%E9%85%8D%E7%BD%AE/ title="Kubernetes ETCD 集群按资源拆分与 TLS 配置"><link rel=alternate type=text/markdown href=https://www.kbsonlong.com/posts/grafana-sqlite3-migrations-to-postgresql/index.md title="Grafana sqlite3 migrations to PostgreSQL - 蜷缩的蜗牛"><link rel=stylesheet href=/css/style.min.css><link rel=preload href=/lib/fontawesome-free/all.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/lib/animate/animate.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Grafana sqlite3 migrations to PostgreSQL","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.kbsonlong.com\/posts\/grafana-sqlite3-migrations-to-postgresql\/"},"genre":"posts","keywords":"pgloader, PostgreSQL, SQLite, 数据迁移","wordcount":1453,"url":"https:\/\/www.kbsonlong.com\/posts\/grafana-sqlite3-migrations-to-postgresql\/","datePublished":"2025-07-23T10:30:00+08:00","dateModified":"2025-07-23T20:30:00+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"作者"},"description":""}</script><script src=/js/head/color-scheme.min.js></script></head><body data-header-desktop=sticky data-header-mobile=auto><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=right><div class=header-title><a href=/ title=蜷缩的蜗牛><img class=logo src=/logo_transparent.png alt=蜷缩的蜗牛 height=32 width=32><span class=header-title-text>蜷缩的蜗牛</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/posts/><i class='fa-solid fa-archive fa-fw fa-sm'></i> 文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class='fa-solid fa-th fa-fw fa-sm'></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class='fa-solid fa-tags fa-fw fa-sm'></i> 标签</a></li><li class=menu-item><a class=menu-link href=/friends/ title=友情链接><i class='fa-solid fa-users fa-fw fa-sm'></i> 友链</a></li><li class=menu-item><a class=menu-link href=/about/><i class='fa-solid fa-info-circle fa-fw fa-sm'></i> 关于</a></li><li class="menu-item d-none-desktop text-center"><a class=menu-link href=https://github.com/kbsonlong/ title=GitHub rel="noopener noreferrer" target=_blank><i class='fa-brands fa-github fa-fw'></i></a></li><li class="menu-item d-none-desktop text-center"><a class=menu-link href=/messages/><i class='fa-solid fa-messages'></i> 留言板</a></li><li class=menu-item><a class=menu-link href=/messages/ title=留言板>留言板</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容…… id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li><li class="menu-item language-switch"><span role=button aria-label=选择语言 title=选择语言><i class="fa-solid fa-language fa-fw" aria-hidden=true></i></span><ul class=sub-menu><li class=menu-item>没有更多翻译</li></ul></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=蜷缩的蜗牛><img class=logo src=/logo_transparent.png alt=蜷缩的蜗牛 height=26 width=26><span class=header-title-text>蜷缩的蜗牛</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容…… id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/posts/><i class='fa-solid fa-archive fa-fw fa-sm'></i> 文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class='fa-solid fa-th fa-fw fa-sm'></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class='fa-solid fa-tags fa-fw fa-sm'></i> 标签</a></li><li class=menu-item><a class=menu-link href=/friends/ title=友情链接><i class='fa-solid fa-users fa-fw fa-sm'></i> 友链</a></li><li class=menu-item><a class=menu-link href=/about/><i class='fa-solid fa-info-circle fa-fw fa-sm'></i> 关于</a></li><li class="menu-item d-none-desktop text-center"><a class=menu-link href=https://github.com/kbsonlong/ title=GitHub rel="noopener noreferrer" target=_blank><i class='fa-brands fa-github fa-fw'></i></a></li><li class="menu-item d-none-desktop text-center"><a class=menu-link href=/messages/><i class='fa-solid fa-messages'></i> 留言板</a></li><li class=menu-item><a class=menu-link href=/messages/ title=留言板>留言板</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span><span class="menu-system-item language-switch">
<span role=button aria-label=选择语言 title=选择语言>简体中文<i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden=true></i></span>
<select class=language-select onchange="location=this.value"><option disabled>没有更多翻译</option></select></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label=合集></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>Grafana Sqlite3 Migrations to PostgreSQL</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><i class="fa-solid fa-user-circle" aria-hidden=true></i>
Anonymous</span></span><span class=post-included-in>&nbsp;收录于 <a href=/categories/%E5%B7%A5%E5%85%B7%E7%AE%B1/ class=post-category title="分类 - 工具箱"><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> 工具箱</a>&ensp;<a href=/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/ class=post-category title="分类 - 数据库"><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> 数据库</a></span></div><div class=post-meta-line><span title="发布于 2025-07-23 10:30:00"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden=true></i><time datetime=2025-07-23>2025-07-23</time></span>&nbsp;<span title="更新于 2025-07-23 20:30:00"><i class="fa-regular fa-calendar-check fa-fw me-1" aria-hidden=true></i><time datetime=2025-07-23>2025-07-23</time></span>&nbsp;<span title="1453 字"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>约 1500 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 3 分钟</span>&nbsp;<span id=busuanzi_container_page_pv class="busuanzi_visitors comment-visitors" data-flag-title="Grafana Sqlite3 Migrations to PostgreSQL"><i class="fa-regular fa-eye fa-fw me-1" aria-hidden=true></i><span id=busuanzi_value_page_pv>-</span>&nbsp;次阅读
</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#准备环境>准备环境</a></li><li><a href=#初始化数据库>初始化数据库</a><ul><li><a href=#启动-postgresql-和-grafana>启动 PostgreSQL 和 Grafana</a></li><li><a href=#导出-grafana-表结构>导出 <code>grafana</code> 表结构</a></li><li><a href=#清理-postgres-数据库>清理 <code>postgres</code> 数据库</a></li></ul></li><li><a href=#导入-grafana-表结构>导入 <code>grafana</code> 表结构</a><ul><li><a href=#启动postgresql>启动PostgreSQL</a></li></ul></li><li><a href=#迁移数据>迁移数据</a><ul><li><a href=#pgloader-脚本>pgloader 脚本</a></li><li><a href=#运行-pgloader>运行 pgloader</a></li></ul></li><li><a href=#pgloader内存耗尽问题解决指南>pgloader内存耗尽问题解决指南</a></li><li><a href=#问题分析>问题分析</a><ul><li><a href=#根本原因>根本原因</a></li><li><a href=#技术背景>技术背景</a></li></ul></li><li><a href=#解决方案>解决方案</a><ul><li><a href=#方案1增加docker容器内存限制>方案1：增加Docker容器内存限制</a></li><li><a href=#方案2优化pgloader配置>方案2：优化pgloader配置</a></li></ul></li><li><a href=#验证步骤>验证步骤</a><ul><li><a href=#1-检查容器资源>1. 检查容器资源</a></li><li><a href=#2-验证数据迁移>2. 验证数据迁移</a></li><li><a href=#3-检查grafana连接>3. 检查Grafana连接</a></li></ul></li><li><a href=#常见问题>常见问题</a><ul><li><a href=#q1-为什么pgloader会出现内存耗尽>Q1: 为什么pgloader会出现内存耗尽？</a></li><li><a href=#q2-如何确定需要多少内存>Q2: 如何确定需要多少内存？</a></li><li><a href=#q3-迁移失败后如何恢复>Q3: 迁移失败后如何恢复？</a></li></ul></li><li><a href=#相关文档>相关文档</a></li><li><a href=#总结>总结</a></li></ul></nav></div></div><div class=content id=content><h2 class=heading-element id=准备环境><span>准备环境</span>
<a href=#%e5%87%86%e5%a4%87%e7%8e%af%e5%a2%83 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><ul><li>pgloader</li><li>PostgreSQL</li><li>Grafana</li></ul><h2 class=heading-element id=初始化数据库><span>初始化数据库</span>
<a href=#%e5%88%9d%e5%a7%8b%e5%8c%96%e6%95%b0%e6%8d%ae%e5%ba%93 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=启动-postgresql-和-grafana><span>启动 PostgreSQL 和 Grafana</span>
<a href=#%e5%90%af%e5%8a%a8-postgresql-%e5%92%8c-grafana class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3.8&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>postgres</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>postgres:15</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>network_mode</span><span class=p>:</span><span class=w> </span><span class=l>host</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>POSTGRES_DB</span><span class=p>:</span><span class=w> </span><span class=l>grafana</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>POSTGRES_USER</span><span class=p>:</span><span class=w> </span><span class=l>grafana</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class=l>grafana</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>postgres_data:/var/lib/postgresql/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./postgresql.conf:/etc/postgresql/postgresql.conf</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=l>postgres -c config_file=/etc/postgresql/postgresql.conf</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>grafana</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>grafana/grafana:12.0.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>grafana</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>network_mode</span><span class=p>:</span><span class=w> </span><span class=l>host</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>GF_DATABASE_TYPE=postgres</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>GF_DATABASE_HOST=localhost:5432</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>GF_DATABASE_NAME=grafana</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>GF_DATABASE_USER=grafana</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>GF_DATABASE_PASSWORD=grafana</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>GF_DATABASE_SSL_MODE=disable</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>postgres</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>postgres_data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class=l>local</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># PostgreSQL 配置文件 - 针对 Grafana 高可用部署优化</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 连接设置</span>
</span></span><span class=line><span class=cl><span class=nv>listen_addresses</span> <span class=o>=</span> <span class=s1>&#39;*&#39;</span>
</span></span><span class=line><span class=cl><span class=nv>port</span> <span class=o>=</span> <span class=m>5432</span>
</span></span><span class=line><span class=cl><span class=nv>max_connections</span> <span class=o>=</span> <span class=m>200</span>
</span></span><span class=line><span class=cl><span class=nv>superuser_reserved_connections</span> <span class=o>=</span> <span class=m>3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 内存设置</span>
</span></span><span class=line><span class=cl><span class=nv>shared_buffers</span> <span class=o>=</span> 256MB
</span></span><span class=line><span class=cl><span class=nv>effective_cache_size</span> <span class=o>=</span> 1GB
</span></span><span class=line><span class=cl><span class=nv>maintenance_work_mem</span> <span class=o>=</span> 64MB
</span></span><span class=line><span class=cl><span class=nv>work_mem</span> <span class=o>=</span> 4MB
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># WAL 设置（用于复制）</span>
</span></span><span class=line><span class=cl><span class=nv>wal_level</span> <span class=o>=</span> replica
</span></span><span class=line><span class=cl><span class=nv>max_wal_senders</span> <span class=o>=</span> <span class=m>3</span>
</span></span><span class=line><span class=cl><span class=nv>max_replication_slots</span> <span class=o>=</span> <span class=m>3</span>
</span></span><span class=line><span class=cl><span class=nv>wal_keep_size</span> <span class=o>=</span> 1GB
</span></span><span class=line><span class=cl><span class=nv>archive_mode</span> <span class=o>=</span> on
</span></span><span class=line><span class=cl><span class=nv>archive_command</span> <span class=o>=</span> <span class=s1>&#39;cp %p /var/lib/postgresql/archive/%f&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 检查点设置</span>
</span></span><span class=line><span class=cl><span class=nv>checkpoint_completion_target</span> <span class=o>=</span> 0.9
</span></span><span class=line><span class=cl><span class=nv>checkpoint_timeout</span> <span class=o>=</span> 15min
</span></span><span class=line><span class=cl><span class=nv>max_wal_size</span> <span class=o>=</span> 2GB
</span></span><span class=line><span class=cl><span class=nv>min_wal_size</span> <span class=o>=</span> 80MB
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 日志设置</span>
</span></span><span class=line><span class=cl><span class=nv>logging_collector</span> <span class=o>=</span> on
</span></span><span class=line><span class=cl><span class=nv>log_directory</span> <span class=o>=</span> <span class=s1>&#39;log&#39;</span>
</span></span><span class=line><span class=cl><span class=nv>log_filename</span> <span class=o>=</span> <span class=s1>&#39;postgresql-%Y-%m-%d_%H%M%S.log&#39;</span>
</span></span><span class=line><span class=cl><span class=nv>log_rotation_age</span> <span class=o>=</span> 1d
</span></span><span class=line><span class=cl><span class=nv>log_rotation_size</span> <span class=o>=</span> 100MB
</span></span><span class=line><span class=cl><span class=nv>log_min_duration_statement</span> <span class=o>=</span> <span class=m>1000</span>
</span></span><span class=line><span class=cl><span class=nv>log_line_prefix</span> <span class=o>=</span> <span class=s1>&#39;%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h &#39;</span>
</span></span><span class=line><span class=cl><span class=nv>log_statement</span> <span class=o>=</span> <span class=s1>&#39;ddl&#39;</span>
</span></span><span class=line><span class=cl><span class=nv>log_temp_files</span> <span class=o>=</span> <span class=m>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 性能优化</span>
</span></span><span class=line><span class=cl><span class=nv>random_page_cost</span> <span class=o>=</span> 1.1
</span></span><span class=line><span class=cl><span class=nv>effective_io_concurrency</span> <span class=o>=</span> <span class=m>200</span>
</span></span><span class=line><span class=cl><span class=nv>default_statistics_target</span> <span class=o>=</span> <span class=m>100</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 安全设置</span>
</span></span><span class=line><span class=cl><span class=nv>ssl</span> <span class=o>=</span> off
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 复制设置</span>
</span></span><span class=line><span class=cl><span class=nv>hot_standby</span> <span class=o>=</span> on
</span></span><span class=line><span class=cl><span class=nv>hot_standby_feedback</span> <span class=o>=</span> on
</span></span><span class=line><span class=cl><span class=nv>max_standby_streaming_delay</span> <span class=o>=</span> 30s
</span></span><span class=line><span class=cl><span class=nv>wal_receiver_timeout</span> <span class=o>=</span> 60s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 自动清理</span>
</span></span><span class=line><span class=cl><span class=nv>autovacuum</span> <span class=o>=</span> on
</span></span><span class=line><span class=cl><span class=nv>autovacuum_max_workers</span> <span class=o>=</span> <span class=m>3</span>
</span></span><span class=line><span class=cl><span class=nv>autovacuum_naptime</span> <span class=o>=</span> 1min
</span></span><span class=line><span class=cl><span class=nv>autovacuum_vacuum_threshold</span> <span class=o>=</span> <span class=m>50</span>
</span></span><span class=line><span class=cl><span class=nv>autovacuum_analyze_threshold</span> <span class=o>=</span> <span class=m>50</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 时区设置</span>
</span></span><span class=line><span class=cl><span class=nv>timezone</span> <span class=o>=</span> <span class=s1>&#39;UTC&#39;</span>
</span></span><span class=line><span class=cl><span class=nv>log_timezone</span> <span class=o>=</span> <span class=s1>&#39;UTC&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 区域设置</span>
</span></span><span class=line><span class=cl><span class=nv>lc_messages</span> <span class=o>=</span> <span class=s1>&#39;en_US.UTF-8&#39;</span>
</span></span><span class=line><span class=cl><span class=nv>lc_monetary</span> <span class=o>=</span> <span class=s1>&#39;en_US.UTF-8&#39;</span>
</span></span><span class=line><span class=cl><span class=nv>lc_numeric</span> <span class=o>=</span> <span class=s1>&#39;en_US.UTF-8&#39;</span>
</span></span><span class=line><span class=cl><span class=nv>lc_time</span> <span class=o>=</span> <span class=s1>&#39;en_US.UTF-8&#39;</span>
</span></span><span class=line><span class=cl><span class=nv>default_text_search_config</span> <span class=o>=</span> <span class=s1>&#39;pg_catalog.english&#39;</span></span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=导出-grafana-表结构><span>导出 <code>grafana</code> 表结构</span>
<a href=#%e5%af%bc%e5%87%ba-grafana-%e8%a1%a8%e7%bb%93%e6%9e%84 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker compose up -d
</span></span><span class=line><span class=cl>docker <span class=nb>exec</span> -ti postgres pg_dump --schema-only  -U grafana grafana &gt; grafana-schema.sql</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=清理-postgres-数据库><span>清理 <code>postgres</code> 数据库</span>
<a href=#%e6%b8%85%e7%90%86-postgres-%e6%95%b0%e6%8d%ae%e5%ba%93 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>停止 <code>postgres</code> 和 <code>grafana</code>,并删除 <code>postgres</code> 数据库</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker compose down
</span></span><span class=line><span class=cl>docker volumes rm postgres-data</span></span></code></pre></td></tr></table></div></div><h2 class=heading-element id=导入-grafana-表结构><span>导入 <code>grafana</code> 表结构</span>
<a href=#%e5%af%bc%e5%85%a5-grafana-%e8%a1%a8%e7%bb%93%e6%9e%84 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=启动postgresql><span>启动PostgreSQL</span>
<a href=#%e5%90%af%e5%8a%a8postgresql class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3.8&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>postgres</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>postgres:15</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>network_mode</span><span class=p>:</span><span class=w> </span><span class=l>host</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>POSTGRES_DB</span><span class=p>:</span><span class=w> </span><span class=l>grafana</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>POSTGRES_USER</span><span class=p>:</span><span class=w> </span><span class=l>grafana</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class=l>grafana</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>postgres_data:/var/lib/postgresql/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./postgresql.conf:/etc/postgresql/postgresql.conf</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=l>postgres -c config_file=/etc/postgresql/postgresql.conf -c hba_file=/etc/postgresql/pg_hba.conf</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>postgres_data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class=l>local</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker <span class=nb>exec</span> -i postgres psql -h localhost -p <span class=m>5432</span> -U grafana -d grafana &lt; grafana-schema.sql</span></span></code></pre></td></tr></table></div></div><h2 class=heading-element id=迁移数据><span>迁移数据</span>
<a href=#%e8%bf%81%e7%a7%bb%e6%95%b0%e6%8d%ae class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=pgloader-脚本><span>pgloader 脚本</span>
<a href=#pgloader-%e8%84%9a%e6%9c%ac class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>load</span><span class=w> </span><span class=k>database</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>from</span><span class=w> </span><span class=n>sqlite</span><span class=p>:</span><span class=o>///</span><span class=k>data</span><span class=o>/</span><span class=n>services</span><span class=o>/</span><span class=n>grafana</span><span class=o>/</span><span class=n>grafana</span><span class=p>.</span><span class=n>db</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>into</span><span class=w> </span><span class=n>postgresql</span><span class=p>:</span><span class=o>//</span><span class=n>grafana</span><span class=p>:</span><span class=n>grafana</span><span class=o>@</span><span class=mi>127</span><span class=p>.</span><span class=mi>0</span><span class=p>.</span><span class=mi>0</span><span class=p>.</span><span class=mi>1</span><span class=o>/</span><span class=n>grafana</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>with</span><span class=w> </span><span class=k>data</span><span class=w> </span><span class=k>only</span><span class=p>,</span><span class=w> </span><span class=k>reset</span><span class=w> </span><span class=n>sequences</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>batch</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1000</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>batch</span><span class=w> </span><span class=k>size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>10</span><span class=n>MB</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>prefetch</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>100</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>set</span><span class=w> </span><span class=n>work_mem</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=s1>&#39;16MB&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>maintenance_work_mem</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=s1>&#39;512MB&#39;</span><span class=p>;</span></span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=运行-pgloader><span>运行 pgloader</span>
<a href=#%e8%bf%90%e8%a1%8c-pgloader class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -m 2g --rm -it --network host -v <span class=sb>`</span><span class=nb>pwd</span><span class=sb>`</span>:/data/services/grafana  ghcr.io/dimitri/pgloader:latest pgloader /data/services/grafana/main.load</span></span></code></pre></td></tr></table></div></div><h2 class=heading-element id=pgloader内存耗尽问题解决指南><span>pgloader内存耗尽问题解决指南</span>
<a href=#pgloader%e5%86%85%e5%ad%98%e8%80%97%e5%b0%bd%e9%97%ae%e9%a2%98%e8%a7%a3%e5%86%b3%e6%8c%87%e5%8d%97 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>在使用pgloader工具将SQLite数据迁移到PostgreSQL时，遇到以下错误：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>fatal error encountered in SBCL pid 1 tid 9:
</span></span><span class=line><span class=cl>Heap exhausted, game over.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Welcome to LDB, a low-level debugger for the Lisp runtime environment.
</span></span><span class=line><span class=cl>(GC in progress, oldspace=1, newspace=7)</span></span></code></pre></td></tr></table></div></div><h2 class=heading-element id=问题分析><span>问题分析</span>
<a href=#%e9%97%ae%e9%a2%98%e5%88%86%e6%9e%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=根本原因><span>根本原因</span>
<a href=#%e6%a0%b9%e6%9c%ac%e5%8e%9f%e5%9b%a0 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><ol><li><strong>内存不足</strong>：pgloader基于SBCL（Steel Bank Common Lisp）运行时，默认堆内存限制较小</li><li><strong>数据量过大</strong>：SQLite数据库文件可能包含大量数据，超出了默认内存限制</li><li><strong>容器资源限制</strong>：Docker容器可能没有分配足够的内存资源</li></ol><h3 class=heading-element id=技术背景><span>技术背景</span>
<a href=#%e6%8a%80%e6%9c%af%e8%83%8c%e6%99%af class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><ul><li>pgloader使用SBCL作为运行时环境</li><li>SBCL默认堆大小通常为几百MB</li><li>大型数据迁移需要更多内存来处理数据缓冲</li></ul><h2 class=heading-element id=解决方案><span>解决方案</span>
<a href=#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=方案1增加docker容器内存限制><span>方案1：增加Docker容器内存限制</span>
<a href=#%e6%96%b9%e6%a1%881%e5%a2%9e%e5%8a%a0docker%e5%ae%b9%e5%99%a8%e5%86%85%e5%ad%98%e9%99%90%e5%88%b6 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 为容器分配更多内存（例如4GB）</span>
</span></span><span class=line><span class=cl>docker run --rm -it --network host <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --memory<span class=o>=</span>4g <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -v <span class=sb>`</span><span class=nb>pwd</span><span class=sb>`</span>:/data/services/grafana <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  ghcr.io/dimitri/pgloader:latest <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  pgloader /data/services/grafana/main.load</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=方案2优化pgloader配置><span>方案2：优化pgloader配置</span>
<a href=#%e6%96%b9%e6%a1%882%e4%bc%98%e5%8c%96pgloader%e9%85%8d%e7%bd%ae class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>修改 <code>main.load</code> 文件，添加内存优化参数：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>load</span><span class=w> </span><span class=k>database</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>from</span><span class=w> </span><span class=n>sqlite</span><span class=p>:</span><span class=o>///</span><span class=k>data</span><span class=o>/</span><span class=n>services</span><span class=o>/</span><span class=n>grafana</span><span class=o>/</span><span class=n>grafana</span><span class=p>.</span><span class=n>db</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>into</span><span class=w> </span><span class=n>postgresql</span><span class=p>:</span><span class=o>//</span><span class=n>grafana</span><span class=p>:</span><span class=n>grafana</span><span class=o>@</span><span class=mi>127</span><span class=p>.</span><span class=mi>0</span><span class=p>.</span><span class=mi>0</span><span class=p>.</span><span class=mi>1</span><span class=o>/</span><span class=n>grafana</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>with</span><span class=w> </span><span class=k>data</span><span class=w> </span><span class=k>only</span><span class=p>,</span><span class=w> </span><span class=k>reset</span><span class=w> </span><span class=n>sequences</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>batch</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1000</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>batch</span><span class=w> </span><span class=k>size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>10</span><span class=n>MB</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>prefetch</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>100</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>set</span><span class=w> </span><span class=n>work_mem</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=s1>&#39;16MB&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>maintenance_work_mem</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=s1>&#39;512MB&#39;</span><span class=p>;</span></span></span></code></pre></td></tr></table></div></div><h2 class=heading-element id=验证步骤><span>验证步骤</span>
<a href=#%e9%aa%8c%e8%af%81%e6%ad%a5%e9%aa%a4 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=1-检查容器资源><span>1. 检查容器资源</span>
<a href=#1-%e6%a3%80%e6%9f%a5%e5%ae%b9%e5%99%a8%e8%b5%84%e6%ba%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 查看容器内存使用情况</span>
</span></span><span class=line><span class=cl>docker stats --no-stream</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=2-验证数据迁移><span>2. 验证数据迁移</span>
<a href=#2-%e9%aa%8c%e8%af%81%e6%95%b0%e6%8d%ae%e8%bf%81%e7%a7%bb class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 连接PostgreSQL检查数据</span>
</span></span><span class=line><span class=cl>psql -h localhost -U grafana -d grafana -c <span class=s2>&#34;\dt&#34;</span>
</span></span><span class=line><span class=cl>psql -h localhost -U grafana -d grafana -c <span class=s2>&#34;SELECT count(*) FROM table_name;&#34;</span></span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=3-检查grafana连接><span>3. 检查Grafana连接</span>
<a href=#3-%e6%a3%80%e6%9f%a5grafana%e8%bf%9e%e6%8e%a5 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 重启Grafana服务</span>
</span></span><span class=line><span class=cl>docker-compose restart grafana
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 检查Grafana日志</span>
</span></span><span class=line><span class=cl>docker-compose logs grafana</span></span></code></pre></td></tr></table></div></div><h2 class=heading-element id=常见问题><span>常见问题</span>
<a href=#%e5%b8%b8%e8%a7%81%e9%97%ae%e9%a2%98 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=q1-为什么pgloader会出现内存耗尽><span>Q1: 为什么pgloader会出现内存耗尽？</span>
<a href=#q1-%e4%b8%ba%e4%bb%80%e4%b9%88pgloader%e4%bc%9a%e5%87%ba%e7%8e%b0%e5%86%85%e5%ad%98%e8%80%97%e5%b0%bd class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>A: pgloader基于SBCL运行时，默认堆内存较小。处理大型数据库时需要更多内存来缓冲数据。</p><h3 class=heading-element id=q2-如何确定需要多少内存><span>Q2: 如何确定需要多少内存？</span>
<a href=#q2-%e5%a6%82%e4%bd%95%e7%a1%ae%e5%ae%9a%e9%9c%80%e8%a6%81%e5%a4%9a%e5%b0%91%e5%86%85%e5%ad%98 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>A: 一般建议分配数据库文件大小的2-3倍内存。例如，100MB的SQLite文件建议分配300MB以上内存。</p><h3 class=heading-element id=q3-迁移失败后如何恢复><span>Q3: 迁移失败后如何恢复？</span>
<a href=#q3-%e8%bf%81%e7%a7%bb%e5%a4%b1%e8%b4%a5%e5%90%8e%e5%a6%82%e4%bd%95%e6%81%a2%e5%a4%8d class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>A: 清空PostgreSQL目标表，检查并修复配置后重新运行迁移。</p><h2 class=heading-element id=相关文档><span>相关文档</span>
<a href=#%e7%9b%b8%e5%85%b3%e6%96%87%e6%a1%a3 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><ul><li><a href=https://pgloader.readthedocs.io/ target=_blank rel="external nofollow noopener noreferrer">pgloader官方文档</a></li><li><a href=http://www.sbcl.org/manual/#Memory-Management target=_blank rel="external nofollow noopener noreferrer">SBCL内存管理</a></li><li><a href=https://www.postgresql.org/docs/current/runtime-config-resource.html target=_blank rel="external nofollow noopener noreferrer">PostgreSQL性能调优</a></li><li><a href=https://docs.docker.com/config/containers/resource_constraints/ target=_blank rel="external nofollow noopener noreferrer">Docker内存限制</a></li></ul><h2 class=heading-element id=总结><span>总结</span>
<a href=#%e6%80%bb%e7%bb%93 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>pgloader内存耗尽问题主要由SBCL运行时的默认内存限制引起。通过增加Docker容器内存、优化pgloader配置、或使用分批迁移策略可以有效解决此问题。建议在大型数据迁移前进行充分的资源规划和测试。</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2025-07-23 20:30:00">更新于 2025-07-23&nbsp;</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/posts/grafana-sqlite3-migrations-to-postgresql/index.md title=阅读原始文档 class=link-to-markdown>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 X" data-sharer=twitter data-url=https://www.kbsonlong.com/posts/grafana-sqlite3-migrations-to-postgresql/ data-title="Grafana Sqlite3 Migrations to PostgreSQL" data-hashtags=pgloader,PostgreSQL,SQLite,数据迁移><i class="fa-brands fa-x-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://www.kbsonlong.com/posts/grafana-sqlite3-migrations-to-postgresql/ data-hashtag=pgloader><i class="fa-brands fa-facebook-square fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 WhatsApp" data-sharer=whatsapp data-url=https://www.kbsonlong.com/posts/grafana-sqlite3-migrations-to-postgresql/ data-title="Grafana Sqlite3 Migrations to PostgreSQL" data-web><i class="fa-brands fa-whatsapp fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://www.kbsonlong.com/posts/grafana-sqlite3-migrations-to-postgresql/ data-title="Grafana Sqlite3 Migrations to PostgreSQL"><svg class="icon" role="img" viewBox="0 0 24 24"><title>LINE</title><path d="M19.365 9.863c.349.0.63.285.63.631.0.345-.281.63-.63.63H17.61v1.125h1.755c.349.0.63.283.63.63.0.344-.281.629-.63.629h-2.386c-.345.0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.346.0.627.285.627.63.0.349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211.0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346.0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195.0.375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345.0.63.285.63.63v4.771zm-5.741.0c0 .344-.282.629-.631.629-.345.0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63.346.0.628.285.628.63v4.771zm-2.466.629H4.917c-.345.0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348.0.63.285.63.63v4.141h1.756c.348.0.629.283.629.63.0.344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943.0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"/></svg></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://www.kbsonlong.com/posts/grafana-sqlite3-migrations-to-postgresql/ data-title="Grafana Sqlite3 Migrations to PostgreSQL"><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Myspace" data-sharer=myspace data-url=https://www.kbsonlong.com/posts/grafana-sqlite3-migrations-to-postgresql/ data-title="Grafana Sqlite3 Migrations to PostgreSQL" data-description><svg class="icon" role="img" viewBox="0 0 24 24"><title>Myspace</title><path d="M19.802 12.274A3.811 3.811.0 0023.62 8.47c0-2.101-1.71-3.795-3.818-3.795a3.816 3.816.0 00-3.818 3.81 3.817 3.817.0 003.818 3.811zm-8.602.705a3.43 3.43.0 003.435-3.424A3.43 3.43.0 0011.2 6.13 3.44 3.44.0 007.764 9.566 3.436 3.436.0 0011.2 13zm-7.8.635c1.71.0 3.093-1.38 3.093-3.081.0-1.704-1.395-3.084-3.105-3.084A3.086 3.086.0 00.3 10.539c0 1.7 1.387 3.078 3.095 3.078zm0 .705c-1.96.0-3.4 1.717-3.4 3.495v1.196c0 .17.138.31.31.31h6.18a.31.31.0 00.309-.31v-1.196c0-1.779-1.437-3.5-3.398-3.5zm7.8-.56c-2.18.0-3.78 1.915-3.78 3.891v1.331c0 .188.156.344.345.344h6.87a.344.344.0 00.342-.344V17.65c0-1.976-1.598-3.891-3.777-3.891zm8.602-.617c-2.422.0-4.197 2.126-4.197 4.323v1.477c0 .21.172.381.382.381h7.63c.21.0.383-.171.383-.381v-1.477c-.001-2.197-1.776-4.323-4.198-4.323z"/></svg></a>
<a href=javascript:void(0); title="分享到 Blogger" data-sharer=blogger data-url=https://www.kbsonlong.com/posts/grafana-sqlite3-migrations-to-postgresql/ data-title="Grafana Sqlite3 Migrations to PostgreSQL" data-description><i class="fa-brands fa-blogger fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Evernote" data-sharer=evernote data-url=https://www.kbsonlong.com/posts/grafana-sqlite3-migrations-to-postgresql/ data-title="Grafana Sqlite3 Migrations to PostgreSQL"><i class="fa-brands fa-evernote fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/pgloader/ class=post-tag title="标签 - Pgloader">Pgloader</a><a href=/tags/postgresql/ class=post-tag title="标签 - PostgreSQL">PostgreSQL</a><a href=/tags/sqlite/ class=post-tag title="标签 - SQLite">SQLite</a><a href=/tags/%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB/ class=post-tag title="标签 - 数据迁移">数据迁移</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/karmada-resourceinterpretercustomization/ class=post-nav-item rel=prev title=Karmada声明式配置详细指引><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>Karmada声明式配置详细指引</a><a href=/posts/kubernetes-etcd-%E9%9B%86%E7%BE%A4%E6%8C%89%E8%B5%84%E6%BA%90%E6%8B%86%E5%88%86%E4%B8%8E-tls-%E9%85%8D%E7%BD%AE/ class=post-nav-item rel=next title="Kubernetes ETCD 集群按资源拆分与 TLS 配置">Kubernetes ETCD 集群按资源拆分与 TLS 配置<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=giscus class=comment><script src=https://giscus.app/client.js data-repo=kbsonlong/sre data-repo-id=R_kgDOMFzwNA data-category=Announcements data-category-id=DIC_kwDOMFzwNM4Cn0gn data-mapping=title data-strict=0 data-theme=preferred_color_scheme data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-lang=zh-CN data-loading=lazy crossorigin=anonymous async defer></script></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app/ rel="external nofollow noopener noreferrer">giscus</a>.</noscript></div></article><aside class=toc id=toc-auto aria-label=目录><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside></main><footer class=footer><div class=footer-container><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2018 - 2025</span><span class=author itemprop=copyrightHolder>
<a href=/></a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class="footer-line statistics"><span class=site-time title=网站运行中……><i class="fa-solid fa-heartbeat fa-fw animate-icon" aria-hidden=true></i><span class="run-times ms-1">网站运行中……</span></span></div><div class="footer-line visitor"><span id=busuanzi_container_site_uv title=总访客数><i class="fa-regular fa-user fa-fw me-1" aria-hidden=true></i><span id=busuanzi_value_site_uv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span><span id=busuanzi_container_site_pv class=footer-divider title=总访问量><i class="fa-regular fa-eye fa-fw me-1" aria-hidden=true></i><span id=busuanzi_value_site_pv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span></div><div class="footer-line beian"><span class="icp footer-divider"><a target=_blank href=https://beian.miit.gov.cn/>粤ICP备18122209号</a></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class=variant-numeric>0%</span></div><div class="fixed-button view-comments d-none" role=button aria-label=查看评论><i class="fa-solid fa-comment fa-fw" aria-hidden=true></i></div></div><a href=https://github.com/kbsonlong title="在 GitHub 上查看源代码" target=_blank rel="external nofollow" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true" width="56" height="56"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><div class=reading-progress-bar style=left:0;top:0></div><noscript><div class=noscript-warning>该网站在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=preload href=/lib/katex/katex.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/katex/katex.min.css></noscript><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/algoliasearch/algoliasearch-lite.umd.min.js defer></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/katex/katex.min.js defer></script><script src=/lib/katex/auto-render.min.js defer></script><script src=/lib/katex/copy-tex.min.js defer></script><script src=/lib/katex/mhchem.min.js defer></script><script src=/lib/cookieconsent/cookieconsent.min.js defer></script><script src=/lib/pangu/pangu.min.js defer></script><script src=/lib/cell-watermark/watermark.min.js defer></script><script src=https://vercount.one/js async defer></script><script>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:10},comment:{enable:!0,expired:!1,giscus:{darkTheme:"dark",lightTheme:"light",origin:"https://giscus.app"}},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},enablePWA:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},pangu:{enable:!0,selector:"article"},search:{algoliaAppID:"WFOR67TML1",algoliaIndex:"along",algoliaSearchKey:"ea1fe535f9a7ae353f3922489c829cc1",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"},siteTime:"2018-12-18T16:15:22+08:00",version:"v0.3.20",watermark:{appendto:".wrapper>main",colspacing:30,content:'<img class="fixit-icon" src="/favicon-16x16.png" alt="FixIt logo" /> FixIt 主题',enable:!0,fontfamily:"inherit",fontsize:.85,height:21,opacity:.0125,rotate:15,rowspacing:60,width:150}}</script><script src=/js/theme.min.js defer></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","6272760969",{anonymize_ip:!0})</script><script src="https://www.googletagmanager.com/gtag/js?id=6272760969" async></script></body></html>