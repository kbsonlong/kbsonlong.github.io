<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Kubernetes - 标签 - 蜷缩的蜗牛</title><link>https://www.kbsonlong.com/tags/kubernetes/</link><description>云原生时代运维</description><generator>Hugo 0.145.0 &amp; FixIt v0.3.20</generator><language>zh-CN</language><copyright>This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.</copyright><lastBuildDate>Wed, 23 Jul 2025 22:00:00 +0800</lastBuildDate><atom:link href="https://www.kbsonlong.com/tags/kubernetes/index.xml" rel="self" type="application/rss+xml"/><item><title>Kubernetes ETCD 集群按资源拆分与 TLS 配置</title><link>https://www.kbsonlong.com/posts/kubernetes-etcd-%E9%9B%86%E7%BE%A4%E6%8C%89%E8%B5%84%E6%BA%90%E6%8B%86%E5%88%86%E4%B8%8E-tls-%E9%85%8D%E7%BD%AE/</link><pubDate>Wed, 23 Jul 2025 22:00:00 +0800</pubDate><guid>https://www.kbsonlong.com/posts/kubernetes-etcd-%E9%9B%86%E7%BE%A4%E6%8C%89%E8%B5%84%E6%BA%90%E6%8B%86%E5%88%86%E4%B8%8E-tls-%E9%85%8D%E7%BD%AE/</guid><category domain="https://www.kbsonlong.com/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</category><description>&lt;h2 class="heading-element" id="kubernetes-etcd-集群按资源拆分与-tls-配置">&lt;span>Kubernetes ETCD 集群按资源拆分与 TLS 配置&lt;/span>
 &lt;a href="#kubernetes-etcd-%e9%9b%86%e7%be%a4%e6%8c%89%e8%b5%84%e6%ba%90%e6%8b%86%e5%88%86%e4%b8%8e-tls-%e9%85%8d%e7%bd%ae" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;p>本文档详细阐述了如何在 Kubernetes 中实现 ETCD 集群按资源拆分，特别是将 &lt;code>events&lt;/code> 等特定资源存储到独立的 ETCD 集群，以及在多 ETCD 集群环境下 &lt;code>kube-apiserver&lt;/code> 的 TLS 证书配置方案。&lt;/p></description></item><item><title>Grafana Alloy discovery.kubernetes 配置故障排查指南</title><link>https://www.kbsonlong.com/posts/grafana-alloy-discovery.kubernetes-%E9%85%8D%E7%BD%AE%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5%E6%8C%87%E5%8D%97/</link><pubDate>Thu, 16 Jan 2025 14:51:11 +0800</pubDate><guid>https://www.kbsonlong.com/posts/grafana-alloy-discovery.kubernetes-%E9%85%8D%E7%BD%AE%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5%E6%8C%87%E5%8D%97/</guid><category domain="https://www.kbsonlong.com/categories/%E7%9B%91%E6%8E%A7%E4%BD%93%E7%B3%BB/">监控体系</category><category domain="https://www.kbsonlong.com/categories/%E6%97%A5%E5%BF%97/">日志</category><description>&lt;h2 class="heading-element" id="概述">&lt;span>概述&lt;/span>
 &lt;a href="#%e6%a6%82%e8%bf%b0" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;p>Grafana Alloy 是新一代的可观测性数据收集器，用于替代 Grafana Agent。在使用 &lt;code>discovery.kubernetes&lt;/code> 组件进行 Kubernetes 服务发现时，经常会遇到配置语法错误。本文将详细介绍常见的配置问题和解决方案。&lt;/p></description></item><item><title>Kind + Flannel + Multus-CNI 快速验证环境搭建指南</title><link>https://www.kbsonlong.com/posts/kind--flannel--multus-cni-%E5%BF%AB%E9%80%9F%E9%AA%8C%E8%AF%81%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97/</link><pubDate>Thu, 19 Dec 2024 10:45:00 +0800</pubDate><guid>https://www.kbsonlong.com/posts/kind--flannel--multus-cni-%E5%BF%AB%E9%80%9F%E9%AA%8C%E8%AF%81%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97/</guid><category domain="https://www.kbsonlong.com/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</category><category domain="https://www.kbsonlong.com/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/">开发环境</category><description>&lt;h2 class="heading-element" id="概述">&lt;span>概述&lt;/span>
 &lt;a href="#%e6%a6%82%e8%bf%b0" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;p>本指南将帮助您使用 &lt;strong>Kind (Kubernetes in Docker)&lt;/strong> 快速创建一个 Kubernetes 环境，并在其中部署和验证 &lt;strong>Flannel + Multus-CNI&lt;/strong> 多网段隔离方案。这是一个完整的端到端验证环境，适合开发、测试和学习使用。&lt;/p></description></item><item><title>Flannel + Multus-CNI 多网段隔离实现指南</title><link>https://www.kbsonlong.com/posts/flannel--multus-cni-%E5%A4%9A%E7%BD%91%E6%AE%B5%E9%9A%94%E7%A6%BB%E5%AE%9E%E7%8E%B0%E6%8C%87%E5%8D%97/</link><pubDate>Thu, 19 Dec 2024 10:30:00 +0800</pubDate><guid>https://www.kbsonlong.com/posts/flannel--multus-cni-%E5%A4%9A%E7%BD%91%E6%AE%B5%E9%9A%94%E7%A6%BB%E5%AE%9E%E7%8E%B0%E6%8C%87%E5%8D%97/</guid><category domain="https://www.kbsonlong.com/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</category><category domain="https://www.kbsonlong.com/categories/%E7%BD%91%E7%BB%9C/">网络</category><description>&lt;h2 class="heading-element" id="概述">&lt;span>概述&lt;/span>
 &lt;a href="#%e6%a6%82%e8%bf%b0" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;p>在 Kubernetes 集群中，单一 CNI 插件往往无法满足复杂的网络需求。本文详细介绍如何使用 &lt;strong>Flannel&lt;/strong> 作为主 CNI 插件，配合 &lt;strong>Multus-CNI&lt;/strong> 实现多网段隔离，为不同类型的工作负载提供专用的网络平面。&lt;/p></description></item><item><title>Grafana Feature Toggles环境变量配置指南</title><link>https://www.kbsonlong.com/posts/grafana-feature-toggles%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/</link><pubDate>Thu, 19 Dec 2024 10:30:00 +0800</pubDate><guid>https://www.kbsonlong.com/posts/grafana-feature-toggles%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/</guid><category domain="https://www.kbsonlong.com/categories/%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7/">运维工具</category><description>&lt;h2 class="heading-element" id="grafana-feature-toggles环境变量配置指南">&lt;span>Grafana Feature Toggles环境变量配置指南&lt;/span>
 &lt;a href="#grafana-feature-toggles%e7%8e%af%e5%a2%83%e5%8f%98%e9%87%8f%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;h2 class="heading-element" id="概述">&lt;span>概述&lt;/span>
 &lt;a href="#%e6%a6%82%e8%bf%b0" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;p>Grafana的Feature Toggles功能允许用户启用实验性或可选功能。本指南详细介绍如何通过环境变量配置Grafana的Feature Toggles，特别是Kubernetes相关功能。&lt;/p></description></item><item><title>使用 Alloy 和 OpenTelemetry 采集 Kubernetes Pod 日志</title><link>https://www.kbsonlong.com/posts/%E4%BD%BF%E7%94%A8-alloy-%E5%92%8C-opentelemetry-%E9%87%87%E9%9B%86-kubernetes-pod-%E6%97%A5%E5%BF%97/</link><pubDate>Thu, 19 Dec 2024 10:30:00 +0800</pubDate><guid>https://www.kbsonlong.com/posts/%E4%BD%BF%E7%94%A8-alloy-%E5%92%8C-opentelemetry-%E9%87%87%E9%9B%86-kubernetes-pod-%E6%97%A5%E5%BF%97/</guid><category domain="https://www.kbsonlong.com/categories/%E7%9B%91%E6%8E%A7%E4%BD%93%E7%B3%BB/">监控体系</category><category domain="https://www.kbsonlong.com/categories/%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86/">日志管理</category><description>&lt;h2 class="heading-element" id="概述">&lt;span>概述&lt;/span>
 &lt;a href="#%e6%a6%82%e8%bf%b0" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;p>本文介绍如何使用 Grafana Alloy 的 &lt;code>discovery.kubernetes&lt;/code> 和 &lt;code>otelcol&lt;/code> 组件实现 Kubernetes Pod 日志采集，完全基于 OpenTelemetry 协议，不依赖 Loki 组件。这种方案具有更好的标准化和互操作性。&lt;/p></description></item><item><title>Karmada多集群管理方案</title><link>https://www.kbsonlong.com/posts/karmada-multi--cluster-management-solution/</link><pubDate>Mon, 27 Nov 2023 18:19:26 +0800</pubDate><guid>https://www.kbsonlong.com/posts/karmada-multi--cluster-management-solution/</guid><category domain="https://www.kbsonlong.com/categories/karmada/">Karmada</category><category domain="https://www.kbsonlong.com/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</category><description>&lt;h2 class="heading-element" id="kubernetes-衍变">&lt;span>&lt;code>Kubernetes&lt;/code> 衍变&lt;/span>
 &lt;a href="#kubernetes-%e8%a1%8d%e5%8f%98" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;p>在云原生时代，&lt;code>Kubernetes&lt;/code> 作为一项核心技术已成为现代应用程序架构的基础，越来越多的企业使用 &lt;code>Kubernetes&lt;/code> 作为容器编排系统，其成为容器编排事实标准得益于 &lt;code>Kubernetes&lt;/code> 的主要有以下几个原因：&lt;/p></description></item><item><title>karmada作为集群资源同步工具在灾备系统中的实践</title><link>https://www.kbsonlong.com/posts/camp/</link><pubDate>Mon, 27 Nov 2023 15:57:25 +0800</pubDate><guid>https://www.kbsonlong.com/posts/camp/</guid><category domain="https://www.kbsonlong.com/categories/kubernetes/">Kubernetes</category><category domain="https://www.kbsonlong.com/categories/karmada/">Karmada</category><description>&lt;h2 class="heading-element" id="karmada是什么">&lt;span>karmada是什么？&lt;/span>
 &lt;a href="#karmada%e6%98%af%e4%bb%80%e4%b9%88" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;p>karmada是一个kubernetes多集群管理系统，它可以保持原有使用apiserver的方式，将资源分布到多个集群中。提供了跨云多集群多模式管理、多策略的多集群调度、应用的跨集群故障转移、全局统一资源视图、多集群的服务发现和FederatedHPA能力。它的设计思路继承了&lt;a href="https://github.com/kubernetes-sigs/kubefed"target="_blank" rel="external nofollow noopener noreferrer">集群联邦v2&lt;/a>，目前是cncf的sandbox开源项目。&lt;/p></description></item><item><title>为什么HPA扩容比较慢</title><link>https://www.kbsonlong.com/posts/%E4%B8%BA%E4%BB%80%E4%B9%88hpa%E6%89%A9%E5%AE%B9%E6%AF%94%E8%BE%83%E6%85%A2/</link><pubDate>Fri, 24 Nov 2023 11:56:32 +0800</pubDate><guid>https://www.kbsonlong.com/posts/%E4%B8%BA%E4%BB%80%E4%B9%88hpa%E6%89%A9%E5%AE%B9%E6%AF%94%E8%BE%83%E6%85%A2/</guid><category domain="https://www.kbsonlong.com/categories/kubernetes/">Kubernetes</category><description>&lt;p>最近遇到业务活动期间遇到突发流量，由于pod资源使用飙升导致业务可用性降低的问题。这里面导致业务不可用的原因有很多，其中一个直接原因是流量来临时候资源使用飙升，而HPA没有及时的进行扩容。
这篇文章就是针对这个问题进行研究，主要从这三方面进行阐述：&lt;/p>
&lt;ol>
&lt;li>扩容有多慢&lt;/li>
&lt;li>为什么扩容慢&lt;/li>
&lt;li>有什么解决方案&lt;/li>
&lt;/ol></description></item><item><title>基于Coredns多集群服务发现</title><link>https://www.kbsonlong.com/posts/discovery-based-on-coredns-multi--cluster-service/</link><pubDate>Tue, 01 Aug 2023 17:38:45 +0800</pubDate><guid>https://www.kbsonlong.com/posts/discovery-based-on-coredns-multi--cluster-service/</guid><category domain="https://www.kbsonlong.com/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</category><category domain="https://www.kbsonlong.com/categories/karmada/">Karmada</category><category domain="https://www.kbsonlong.com/categories/kubernetes/">Kubernetes</category><description>&lt;p>在&lt;a href="https://kbsonlong.github.io/posts/2296fc/"target="_blank" rel="external nofollow noopener noreferrer">Karmada 多集群服务发现&lt;/a>一文中跨集群调用时有个派生的前缀 &lt;code>derived-&amp;lt;service name&amp;gt;&lt;/code>, 对于应用调用上有感知，本文介绍如何让应用在调用本地集群或者跨集群都是用同一个service。&lt;/p>
&lt;p>基础环境 &lt;a href="https://kbsonlong.github.io/posts/2296fc/"target="_blank" rel="external nofollow noopener noreferrer">Karmada 多集群服务发现&lt;/a>&lt;/p></description></item><item><title>03-kube-controller-manager源码分析(Deployment控制器)</title><link>https://www.kbsonlong.com/posts/03-kube-controller-manager-source-code-analysis-deployment-controller/</link><pubDate>Fri, 28 Jul 2023 17:18:49 +0800</pubDate><guid>https://www.kbsonlong.com/posts/03-kube-controller-manager-source-code-analysis-deployment-controller/</guid><category domain="https://www.kbsonlong.com/categories/kubernetes/">Kubernetes</category><category domain="https://www.kbsonlong.com/categories/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">源码分析</category><description>&lt;p>本文基于&lt;a href="https://github.com/kubernetes/kubernetes/tree/v1.29.0"target="_blank" rel="external nofollow noopener noreferrer">1.29.0&lt;/a>版本&lt;/p>
&lt;h2 class="heading-element" id="kube-controller-manager">&lt;span>kube-controller-manager&lt;/span>
 &lt;a href="#kube-controller-manager" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;p>pkg/controller目录结构,包含各控制器的具体实现&lt;/p></description></item><item><title>01-利用vscode与kind搭建kubernetes开发环境</title><link>https://www.kbsonlong.com/posts/01-use-vscode-and-kind-to-build-kubernetes-development-environment/</link><pubDate>Fri, 07 Jul 2023 16:50:30 +0800</pubDate><guid>https://www.kbsonlong.com/posts/01-use-vscode-and-kind-to-build-kubernetes-development-environment/</guid><category domain="https://www.kbsonlong.com/categories/kubernetes/">Kubernetes</category><description>&lt;p>本文基于&lt;a href="https://github.com/kubernetes/kubernetes/tree/v1.27.0"target="_blank" rel="external nofollow noopener noreferrer">1.27.0&lt;/a>版本&lt;/p>
&lt;h2 class="heading-element" id="kind-创建集群">&lt;span>Kind 创建集群&lt;/span>
 &lt;a href="#kind-%e5%88%9b%e5%bb%ba%e9%9b%86%e7%be%a4" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="l">cat &amp;lt;&amp;lt; EOF &amp;gt; dev.yaml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Cluster&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;kind.x-k8s.io/v1alpha4&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">kubeadmConfigPatches&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="p">|&lt;/span>&lt;span class="sd">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> apiVersion: kubeadm.k8s.io/v1beta1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> kind: ClusterConfiguration
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> metadata:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> name: dev
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> imageRepository: registry.aliyuncs.com/google_containers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">networking&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">podSubnet&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;10.8.0.0/16&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">serviceSubnet&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;10.9.0.0/16&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">nodes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">role&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">control-plane&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kindest/node:v1.27.0@sha256:c6b22e613523b1af67d4bc8a0c38a4c3ea3a2b8fbc5b367ae36345c9cb844518&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">extraPortMappings&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">containerPort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">2379&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">hostPort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">2379&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">protocol&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">TCP&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">EOF&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">kind create cluster --name dev --config=dev.yaml&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>源码分析 kubernetes scheduler 核心调度器的实现原理</title><link>https://www.kbsonlong.com/posts/source-code-analysis-of-the-implementation-principles-of-kubernetes-scheduler-core-schedu/</link><pubDate>Tue, 18 Apr 2023 21:53:59 +0800</pubDate><guid>https://www.kbsonlong.com/posts/source-code-analysis-of-the-implementation-principles-of-kubernetes-scheduler-core-schedu/</guid><category domain="https://www.kbsonlong.com/categories/kubernetes/">Kubernetes</category><description>&lt;p>&lt;img loading="lazy" src='https://xiaorui-cc.oss-cn-hangzhou.aliyuncs.com/images/202301/202301251502086.png' alt="https://xiaorui-cc.oss-cn-hangzhou.aliyuncs.com/images/202301/202301251502086.png">&lt;/p>
&lt;blockquote>
&lt;p>基于 kubernetes &lt;code>v1.27.0&lt;/code> 源码分析 scheduler 调度器&lt;/p>&lt;/blockquote>
&lt;p>k8s scheduler 的主要职责是为新创建的 pod 寻找一个最合适的 node 节点, 然后进行 bind node 绑定, 后面 kubelet 才会监听到并创建真正的 pod.&lt;/p>
&lt;p>那么问题来了, 如何为 pod 寻找最合适的 node ? 调度器需要经过 predicates 预选和 priority 优选.&lt;/p></description></item><item><title>Kubernetes创建只读用户</title><link>https://www.kbsonlong.com/posts/kubernetes-creates-only-read-users/</link><pubDate>Thu, 12 Jan 2023 13:05:10 +0800</pubDate><guid>https://www.kbsonlong.com/posts/kubernetes-creates-only-read-users/</guid><category domain="https://www.kbsonlong.com/categories/kubernetes/">Kubernetes</category><description>&lt;h3 class="heading-element" id="1-安装cfssl">&lt;span>1 安装cfssl&lt;/span>
 &lt;a href="#1-%e5%ae%89%e8%a3%85cfssl" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">mkdir -p /nfs/k8s-backup/readonly
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> /nfs/k8s-backup/readonly
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://pkg.cfssl.org/R1.2/cfssl_linux-amd64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mv cfssl_linux-amd64 cfssl
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mv cfssljson_linux-amd64 cfssljson
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://pkg.cfssl.org/R1.2/cfssl-certinfo_linux-amd64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mv cfssl-certinfo_linux-amd64 cfssl-certinfo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chmod +x *&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 class="heading-element" id="2-签发客户端证书">&lt;span>2 签发客户端证书&lt;/span>
 &lt;a href="#2-%e7%ad%be%e5%8f%91%e5%ae%a2%e6%88%b7%e7%ab%af%e8%af%81%e4%b9%a6" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;p>根据ca证书和秘钥签发用户证书，kubeadm工具安装是默认生成存放在/etc/kubernetes/pki目录下&lt;/p></description></item><item><title>理解 Kubernetes 的亲和性调度</title><link>https://www.kbsonlong.com/posts/understand-the-affinity-scheduling-of-kubernetes/</link><pubDate>Thu, 08 Mar 2018 00:00:00 +0000</pubDate><guid>https://www.kbsonlong.com/posts/understand-the-affinity-scheduling-of-kubernetes/</guid><description>&lt;p>一般情况下我们部署的 POD 是通过集群自动调度选择某个节点的，默认情况下调度器考虑的是资源足够，并且负载尽量平均，但是有的时候我们需要能够更加细粒度的去控制 POD 的调度，比如我们内部的一些服务 gitlab 之类的也是跑在&lt;code>Kubernetes&lt;/code>集群上的，我们就不希望对外的一些服务和内部的服务跑在同一个节点上了，害怕内部服务对外部的服务产生影响；有的时候呢我们两个服务直接交流比较频繁，又希望能够将这两个服务的 POD 调度到同样的节点上。这就需要用到 Kubernetes 里面的一个概念：亲和性，亲和性主要分为两类：&lt;code>nodeAffinity&lt;/code>和&lt;code>podAffinity&lt;/code>。&lt;/p></description></item></channel></rss>